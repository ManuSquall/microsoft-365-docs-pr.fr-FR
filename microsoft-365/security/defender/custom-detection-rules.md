---
title: Créer et gérer des règles de détection personnalisées dans Microsoft 365 Defender
description: Découvrez comment créer et gérer des règles de détection personnalisées basées sur des requêtes de repérage avancé
keywords: repérage avancé, repérage de menace, repérage de cybermenace, Microsoft 365 Defender, microsoft 365, m365, recherche, requête, télémétrie, détections personnalisées, règles, schéma, kusto, RBAC, autorisations, Microsoft Defender pour point de terminaison
search.product: eADQiWindows 10XVcnh
search.appverid: met150
ms.prod: m365-security
ms.mktglfcycl: deploy
ms.sitesec: library
ms.pagetype: security
f1.keywords:
- NOCSH
ms.author: maccruz
author: schmurky
localization_priority: Normal
manager: dansimp
audience: ITPro
ms.collection:
- M365-security-compliance
- m365initiative-m365-defender
ms.topic: article
ms.technology: m365d
ms.openlocfilehash: f37cc63c958331f7c03e09689de92c73fd06b4d4
ms.sourcegitcommit: 7cc2be0244fcc30049351e35c25369cacaaf4ca9
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/22/2021
ms.locfileid: "51952559"
---
# <a name="create-and-manage-custom-detections-rules"></a><span data-ttu-id="6bf0d-104">Créer et gérer des règles de détection personnalisées</span><span class="sxs-lookup"><span data-stu-id="6bf0d-104">Create and manage custom detections rules</span></span>

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender.md)]


<span data-ttu-id="6bf0d-105">**S’applique à :**</span><span class="sxs-lookup"><span data-stu-id="6bf0d-105">**Applies to:**</span></span>
- <span data-ttu-id="6bf0d-106">Microsoft 365 Defender</span><span class="sxs-lookup"><span data-stu-id="6bf0d-106">Microsoft 365 Defender</span></span>
- <span data-ttu-id="6bf0d-107">Microsoft Defender pour point de terminaison</span><span class="sxs-lookup"><span data-stu-id="6bf0d-107">Microsoft Defender for Endpoint</span></span>

<span data-ttu-id="6bf0d-108">Les règles de détection personnalisées sont des règles que vous pouvez concevoir et modifier à l’aide de requêtes [de repérage](advanced-hunting-overview.md) avancé.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-108">Custom detection rules are rules you can design and tweak using [advanced hunting](advanced-hunting-overview.md) queries.</span></span> <span data-ttu-id="6bf0d-109">Ces règles vous permet de surveiller de manière proactive différents événements et états système, y compris les activités suspectées de violation et les points de terminaison mal configurés.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-109">These rules let you proactively monitor various events and system states, including suspected breach activity and misconfigured endpoints.</span></span> <span data-ttu-id="6bf0d-110">Vous pouvez les configurer pour qu’ils s’exécutent à intervalles réguliers, générant des alertes et prenant des mesures de réponse chaque fois qu’il existe des correspondances.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-110">You can set them to run at regular intervals, generating alerts and taking response actions whenever there are matches.</span></span>

## <a name="required-permissions-for-managing-custom-detections"></a><span data-ttu-id="6bf0d-111">Autorisations requises pour la gestion des détections personnalisées</span><span class="sxs-lookup"><span data-stu-id="6bf0d-111">Required permissions for managing custom detections</span></span>

<span data-ttu-id="6bf0d-112">Pour gérer les détections personnalisées, vous devez avoir l’un des rôles ci-après :</span><span class="sxs-lookup"><span data-stu-id="6bf0d-112">To manage custom detections, you need to be assigned one of these roles:</span></span>

- <span data-ttu-id="6bf0d-113">**Administrateur de sécurité**: les utilisateurs ayant [ce rôle Azure Active Directory gérer](/azure/active-directory/users-groups-roles/directory-assign-admin-roles#security-administrator) les paramètres de sécurité dans Microsoft 365 centre de sécurité et d’autres portails et services.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-113">**Security administrator**—Users with this [Azure Active Directory role](/azure/active-directory/users-groups-roles/directory-assign-admin-roles#security-administrator) can manage security settings in Microsoft 365 security center and other portals and services.</span></span>

- <span data-ttu-id="6bf0d-114">**Opérateur de sécurité**: les utilisateurs dotés de ce [rôle Azure Active Directory](/azure/active-directory/users-groups-roles/directory-assign-admin-roles#security-administrator) peuvent gérer les alertes et ont un accès global en lecture seule aux fonctionnalités liées à la sécurité, y compris à toutes les informations dans Microsoft 365 centre de sécurité.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-114">**Security operator**—Users with this [Azure Active Directory role](/azure/active-directory/users-groups-roles/directory-assign-admin-roles#security-administrator) can manage alerts and have global read-only access to security-related features, including all information in Microsoft 365 security center.</span></span> <span data-ttu-id="6bf0d-115">Ce rôle est suffisant pour la gestion des détections personnalisées uniquement si le contrôle d’accès basé sur un rôle (RBAC) est désactivé dans Microsoft Defender pour point de terminaison.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-115">This role is sufficient for managing custom detections only if role-based access control (RBAC) is turned off in Microsoft Defender for Endpoint.</span></span> <span data-ttu-id="6bf0d-116">Si vous avez configuré RBAC, vous avez également besoin de l’autorisation gérer les **paramètres** de sécurité pour Defender for Endpoint.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-116">If you have RBAC configured, you also need the **manage security settings** permission for Defender for Endpoint.</span></span>

<span data-ttu-id="6bf0d-117">Pour gérer les autorisations requises, un **administrateur général** peut :</span><span class="sxs-lookup"><span data-stu-id="6bf0d-117">To manage required permissions, a **global administrator** can:</span></span>

- <span data-ttu-id="6bf0d-118">Attribuez le  **rôle d’administrateur de sécurité** ou d’opérateur de sécurité [dans Microsoft 365'administration sous](https://admin.microsoft.com/) Administrateur de **sécurité** des  >  **rôles.**</span><span class="sxs-lookup"><span data-stu-id="6bf0d-118">Assign the **security administrator** or **security operator** role in [Microsoft 365 admin center](https://admin.microsoft.com/) under **Roles** > **Security admin**.</span></span>
- <span data-ttu-id="6bf0d-119">Vérifiez les paramètres RBAC pour Microsoft Defender pour le point de terminaison [dans Centre de sécurité Microsoft Defender](https://securitycenter.windows.com/) sous **Paramètres**  >  **rôles d’autorisations.**  >  </span><span class="sxs-lookup"><span data-stu-id="6bf0d-119">Check RBAC settings for Microsoft Defender for Endpoint in [Microsoft Defender Security Center](https://securitycenter.windows.com/) under **Settings** > **Permissions** > **Roles**.</span></span> <span data-ttu-id="6bf0d-120">Sélectionnez le rôle correspondant pour attribuer **l’autorisation gérer les paramètres de** sécurité.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-120">Select the corresponding role to assign the **manage security settings** permission.</span></span>

> [!NOTE]
> <span data-ttu-id="6bf0d-121">Pour gérer les  détections personnalisées, les opérateurs de sécurité auront besoin de l’autorisation gérer les **paramètres** de sécurité dans Microsoft Defender pour le point de terminaison si le contrôle d’accès en fonction du contrôle d’accès (RBAC) est allumé.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-121">To manage custom detections, **security operators** will need the **manage security settings** permission in Microsoft Defender for Endpoint if RBAC is turned on.</span></span>

## <a name="create-a-custom-detection-rule"></a><span data-ttu-id="6bf0d-122">Créer une règle de détection personnalisée</span><span class="sxs-lookup"><span data-stu-id="6bf0d-122">Create a custom detection rule</span></span>
### <a name="1-prepare-the-query"></a><span data-ttu-id="6bf0d-123">1. Préparez la requête.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-123">1. Prepare the query.</span></span>

<span data-ttu-id="6bf0d-124">Dans Microsoft 365 de sécurité, allez  à la recherche avancée et sélectionnez une requête existante ou créez une nouvelle requête.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-124">In Microsoft 365 security center, go to **Advanced hunting** and select an existing query or create a new query.</span></span> <span data-ttu-id="6bf0d-125">Lorsque vous utilisez une nouvelle requête, exécutez la requête pour identifier les erreurs et comprendre les résultats possibles.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-125">When using a new query, run the query to identify errors and understand possible results.</span></span>

>[!IMPORTANT]
><span data-ttu-id="6bf0d-126">Pour empêcher le service de renvoyer trop d’alertes, chaque règle est limitée à générer seulement 100 alertes chaque fois qu’elle s’exécute.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-126">To prevent the service from returning too many alerts, each rule is limited to generating only 100 alerts whenever it runs.</span></span> <span data-ttu-id="6bf0d-127">Avant de créer une règle, modifiez votre requête afin d’éviter les alertes pour une activité normale au quotidien.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-127">Before creating a rule, tweak your query to avoid alerting for normal, day-to-day activity.</span></span>


#### <a name="required-columns-in-the-query-results"></a><span data-ttu-id="6bf0d-128">Colonnes requises dans les résultats de la requête</span><span class="sxs-lookup"><span data-stu-id="6bf0d-128">Required columns in the query results</span></span>
<span data-ttu-id="6bf0d-129">Pour créer une règle de détection personnalisée, la requête doit renvoyer les colonnes suivantes :</span><span class="sxs-lookup"><span data-stu-id="6bf0d-129">To create a custom detection rule, the query must return the following columns:</span></span>

- <span data-ttu-id="6bf0d-130">`Timestamp`— utilisé pour définir l’timestamp pour les alertes générées</span><span class="sxs-lookup"><span data-stu-id="6bf0d-130">`Timestamp`—used to set the timestamp for generated alerts</span></span>
- <span data-ttu-id="6bf0d-131">`ReportId`— active les recherche pour les enregistrements d’origine</span><span class="sxs-lookup"><span data-stu-id="6bf0d-131">`ReportId`—enables lookups for the original records</span></span>
- <span data-ttu-id="6bf0d-132">Une des colonnes suivantes qui identifient des appareils, des utilisateurs ou des boîtes aux lettres spécifiques :</span><span class="sxs-lookup"><span data-stu-id="6bf0d-132">One of the following columns that identify specific devices, users, or mailboxes:</span></span>
    - `DeviceId`
    - `DeviceName`
    - `RemoteDeviceName`
    - `RecipientEmailAddress`
    - <span data-ttu-id="6bf0d-133">`SenderFromAddress` (expéditeur d’enveloppe ou adresse Return-Path'expéditeur)</span><span class="sxs-lookup"><span data-stu-id="6bf0d-133">`SenderFromAddress` (envelope sender or Return-Path address)</span></span>
    - <span data-ttu-id="6bf0d-134">`SenderMailFromAddress` (adresse de l’expéditeur affichée par le client de messagerie)</span><span class="sxs-lookup"><span data-stu-id="6bf0d-134">`SenderMailFromAddress` (sender address displayed by email client)</span></span>
    - `RecipientObjectId`
    - `AccountObjectId`
    - `AccountSid`
    - `AccountUpn`
    - `InitiatingProcessAccountSid`
    - `InitiatingProcessAccountUpn`
    - `InitiatingProcessAccountObjectId`

>[!NOTE]
><span data-ttu-id="6bf0d-135">La prise en charge d’entités supplémentaires est ajoutée lorsque de nouvelles tables sont ajoutées au schéma de [recherche avancé.](advanced-hunting-schema-tables.md)</span><span class="sxs-lookup"><span data-stu-id="6bf0d-135">Support for additional entities will be added as new tables are added to the [advanced hunting schema](advanced-hunting-schema-tables.md).</span></span>

<span data-ttu-id="6bf0d-136">Les requêtes simples, telles que celles qui n’utilisent pas l’opérateur ou l’opérateur pour personnaliser ou agréger des résultats, retournent généralement `project` `summarize` ces colonnes courantes.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-136">Simple queries, such as those that don't use the `project` or `summarize` operator to customize or aggregate results, typically return these common columns.</span></span>

<span data-ttu-id="6bf0d-137">Il existe plusieurs façons de s’assurer que les requêtes plus complexes retournent ces colonnes.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-137">There are various ways to ensure more complex queries return these columns.</span></span> <span data-ttu-id="6bf0d-138">Par exemple, si vous préférez agréger et compter par entité sous une colonne telle que , vous pouvez toujours renvoyer et en l’obtenant à partir de l’événement le plus récent impliquant `DeviceId` `Timestamp` chaque unique `ReportId` `DeviceId` .</span><span class="sxs-lookup"><span data-stu-id="6bf0d-138">For example, if you prefer to aggregate and count by entity under a column such as `DeviceId`, you can still return `Timestamp` and `ReportId` by getting it from the most recent event involving each unique `DeviceId`.</span></span>

<span data-ttu-id="6bf0d-139">L’exemple de requête ci-dessous compte le nombre d’appareils uniques ( ) avec détections antivirus et utilise ce nombre pour rechercher uniquement les appareils avec plus de `DeviceId` cinq détections.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-139">The sample query below counts the number of unique devices (`DeviceId`) with antivirus detections and uses this count to find only the devices with more than five detections.</span></span> <span data-ttu-id="6bf0d-140">Pour renvoyer la dernière `Timestamp` et la `ReportId` correspondante, elle utilise l’opérateur `summarize` avec la `arg_max` fonction.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-140">To return the latest `Timestamp` and the corresponding `ReportId`, it uses the `summarize` operator with the `arg_max` function.</span></span>

```kusto
DeviceEvents
| where Timestamp > ago(1d)
| where ActionType == "AntivirusDetection"
| summarize (Timestamp, ReportId)=arg_max(Timestamp, ReportId), count() by DeviceId
| where count_ > 5
```

> [!TIP]
> <span data-ttu-id="6bf0d-141">Pour de meilleures performances de requête, définissez un filtre d’heure qui correspond à la fréquence d’exécution prévue pour la règle.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-141">For better query performance, set a time filter that matches your intended run frequency for the rule.</span></span> <span data-ttu-id="6bf0d-142">Étant donné que l’utilisation la moins fréquente _est toutes les 24 heures,_ le filtrage de la journée passée couvrira toutes les nouvelles données.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-142">Since the least frequent run is _every 24 hours_, filtering for the past day will cover all new data.</span></span>

### <a name="2-create-new-rule-and-provide-alert-details"></a><span data-ttu-id="6bf0d-143">2. Créez une règle et fournissez des détails sur l’alerte.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-143">2. Create new rule and provide alert details.</span></span>

<span data-ttu-id="6bf0d-144">Avec la requête dans l’éditeur  de requête, sélectionnez Créer une règle de détection et spécifiez les détails d’alerte suivants :</span><span class="sxs-lookup"><span data-stu-id="6bf0d-144">With the query in the query editor, select **Create detection rule** and specify the following alert details:</span></span>

- <span data-ttu-id="6bf0d-145">**Nom de la détection**: nom de la règle de détection</span><span class="sxs-lookup"><span data-stu-id="6bf0d-145">**Detection name**—name of the detection rule</span></span>
- <span data-ttu-id="6bf0d-146">**Fréquence**: intervalle d’exécution de la requête et d’action.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-146">**Frequency**—interval for running the query and taking action.</span></span> [<span data-ttu-id="6bf0d-147">Voir les conseils supplémentaires ci-dessous</span><span class="sxs-lookup"><span data-stu-id="6bf0d-147">See additional guidance below</span></span>](#rule-frequency)
- <span data-ttu-id="6bf0d-148">**Titre de l’alerte**: titre affiché avec les alertes déclenchées par la règle</span><span class="sxs-lookup"><span data-stu-id="6bf0d-148">**Alert title**—title displayed with alerts triggered by the rule</span></span>
- <span data-ttu-id="6bf0d-149">**Gravité :** risque potentiel du composant ou de l’activité identifié par la règle</span><span class="sxs-lookup"><span data-stu-id="6bf0d-149">**Severity**—potential risk of the component or activity identified by the rule</span></span>
- <span data-ttu-id="6bf0d-150">**Catégorie :** composant ou activité de menace identifié par la règle</span><span class="sxs-lookup"><span data-stu-id="6bf0d-150">**Category**—threat component or activity identified by the rule</span></span>
- <span data-ttu-id="6bf0d-151">**MITRE ATT&techniques CK**: une ou plusieurs techniques d’attaque identifiées par la règle, comme documenté dans l’infrastructure [MITRE ATT&CK.](https://attack.mitre.org/)</span><span class="sxs-lookup"><span data-stu-id="6bf0d-151">**MITRE ATT&CK techniques**—one or more attack techniques identified by the rule as documented in the [MITRE ATT&CK framework](https://attack.mitre.org/).</span></span> <span data-ttu-id="6bf0d-152">Cette section est masquée pour certaines catégories d’alertes, notamment les programmes malveillants, les ransomware, les activités suspectes et les logiciels indésirables</span><span class="sxs-lookup"><span data-stu-id="6bf0d-152">This section is hidden for certain alert categories, including malware, ransomware, suspicious activity, and unwanted software</span></span>
- <span data-ttu-id="6bf0d-153">**Description :** plus d’informations sur le composant ou l’activité identifié par la règle</span><span class="sxs-lookup"><span data-stu-id="6bf0d-153">**Description**—more information about the component or activity identified by the rule</span></span> 
- <span data-ttu-id="6bf0d-154">**Actions recommandées**: actions supplémentaires que les répondeurs peuvent prendre en réponse à une alerte</span><span class="sxs-lookup"><span data-stu-id="6bf0d-154">**Recommended actions**—additional actions that responders might take in response to an alert</span></span>

#### <a name="rule-frequency"></a><span data-ttu-id="6bf0d-155">Fréquence des règles</span><span class="sxs-lookup"><span data-stu-id="6bf0d-155">Rule frequency</span></span>
<span data-ttu-id="6bf0d-156">Lorsque vous enregistrez une nouvelle règle, elle s’exécute et recherche les correspondances des 30 derniers jours de données.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-156">When you save a new rule, it runs and checks for matches from the past 30 days of data.</span></span> <span data-ttu-id="6bf0d-157">La règle s’exécute ensuite à intervalles fixes, en appliquant une durée de recherche en fonction de la fréquence que vous choisissez :</span><span class="sxs-lookup"><span data-stu-id="6bf0d-157">The rule then runs again at fixed intervals, applying a lookback duration based on the frequency you choose:</span></span>

- <span data-ttu-id="6bf0d-158">**Toutes les 24 heures**: s’exécute toutes les 24 heures, en vérifiant les données des 30 derniers jours</span><span class="sxs-lookup"><span data-stu-id="6bf0d-158">**Every 24 hours**—runs every 24 hours, checking data from the past 30 days</span></span>
- <span data-ttu-id="6bf0d-159">**Toutes les 12 heures**: s’exécute toutes les 12 heures, en vérifiant les données des dernières 24 heures</span><span class="sxs-lookup"><span data-stu-id="6bf0d-159">**Every 12 hours**—runs every 12 hours, checking data from the past 24 hours</span></span>
- <span data-ttu-id="6bf0d-160">**Toutes les 3 heures :** s’exécute toutes les 3 heures, en vérifiant les données des 6 dernières heures</span><span class="sxs-lookup"><span data-stu-id="6bf0d-160">**Every 3 hours**—runs every 3 hours, checking data from the past 6 hours</span></span>
- <span data-ttu-id="6bf0d-161">**Toutes les heures**: s’exécute toutes les heures, en vérifiant les données des dernières 2 heures</span><span class="sxs-lookup"><span data-stu-id="6bf0d-161">**Every hour**—runs hourly, checking data from the past 2 hours</span></span>

<span data-ttu-id="6bf0d-162">Lorsque vous modifiez une règle, elle s’exécute avec les modifications appliquées lors de la prochaine utilisation prévue en fonction de la fréquence que vous avez définie.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-162">When you edit a rule, it will run with the applied changes in the next run time scheduled according to the frequency you set.</span></span>



>[!TIP]
> <span data-ttu-id="6bf0d-163">Faire correspondre les filtres d’heure de votre requête à la durée de la recherche.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-163">Match the time filters in your query with the lookback duration.</span></span> <span data-ttu-id="6bf0d-164">Les résultats en dehors de la durée de la recherche sont ignorés.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-164">Results outside of the lookback duration are ignored.</span></span>  

<span data-ttu-id="6bf0d-165">Sélectionnez la fréquence qui correspond à la fréquence à laquelle vous souhaitez surveiller les détections.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-165">Select the frequency that matches how closely you want to monitor detections.</span></span> <span data-ttu-id="6bf0d-166">Prenez en compte la capacité de votre organisation à répondre aux alertes.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-166">Consider your organization's capacity to respond to the alerts.</span></span>

### <a name="3-choose-the-impacted-entities"></a><span data-ttu-id="6bf0d-167">3. Choisissez les entités impactées.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-167">3. Choose the impacted entities.</span></span>
<span data-ttu-id="6bf0d-168">Identifiez les colonnes dans les résultats de votre requête où vous vous attendez à trouver l’entité principale affectée ou concernée.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-168">Identify the columns in your query results where you expect to find the main affected or impacted entity.</span></span> <span data-ttu-id="6bf0d-169">Par exemple, une requête peut renvoyer des adresses d’expéditeur ( ou ) et de `SenderFromAddress` `SenderMailFromAddress` destinataire ( `RecipientEmailAddress` ).</span><span class="sxs-lookup"><span data-stu-id="6bf0d-169">For example, a query might return sender (`SenderFromAddress` or `SenderMailFromAddress`) and recipient (`RecipientEmailAddress`) addresses.</span></span> <span data-ttu-id="6bf0d-170">L’identification de l’entité principale concernée par l’identification de ces colonnes permet au service d’agréger les alertes pertinentes, de corréler les incidents et les actions de réponse cible.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-170">Identifying which of these columns represent the main impacted entity helps the service aggregate relevant alerts, correlate incidents, and target response actions.</span></span>

<span data-ttu-id="6bf0d-171">Vous ne pouvez sélectionner qu’une seule colonne pour chaque type d’entité (boîte aux lettres, utilisateur ou appareil).</span><span class="sxs-lookup"><span data-stu-id="6bf0d-171">You can select only one column for each entity type (mailbox, user, or device).</span></span> <span data-ttu-id="6bf0d-172">Les colonnes qui ne sont pas renvoyées par votre requête ne peuvent pas être sélectionnées.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-172">Columns that are not returned by your query can't be selected.</span></span>

### <a name="4-specify-actions"></a><span data-ttu-id="6bf0d-173">4. Spécifiez les actions.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-173">4. Specify actions.</span></span>
<span data-ttu-id="6bf0d-174">Votre règle de détection personnalisée peut prendre automatiquement des mesures sur les appareils, les fichiers ou les utilisateurs renvoyés par la requête.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-174">Your custom detection rule can automatically take actions on devices, files, or users that are returned by the query.</span></span>

#### <a name="actions-on-devices"></a><span data-ttu-id="6bf0d-175">Actions sur les appareils</span><span class="sxs-lookup"><span data-stu-id="6bf0d-175">Actions on devices</span></span>
<span data-ttu-id="6bf0d-176">Ces actions sont appliquées aux appareils dans la `DeviceId` colonne des résultats de la requête :</span><span class="sxs-lookup"><span data-stu-id="6bf0d-176">These actions are applied to devices in the `DeviceId` column of the query results:</span></span>
- <span data-ttu-id="6bf0d-177">**Isoler l’appareil**: utilise Microsoft Defender pour le point de terminaison pour appliquer une isolation complète du réseau, ce qui empêche l’appareil de se connecter à n’importe quelle application ou service.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-177">**Isolate device**—uses Microsoft Defender for Endpoint to apply full network isolation, preventing the device from connecting to any application or service.</span></span> [<span data-ttu-id="6bf0d-178">En savoir plus sur l’isolation des ordinateurs Microsoft Defender pour Endpoint</span><span class="sxs-lookup"><span data-stu-id="6bf0d-178">Learn more about Microsoft Defender for Endpoint machine isolation</span></span>](/windows/security/threat-protection/microsoft-defender-atp/respond-machine-alerts#isolate-devices-from-the-network)
- <span data-ttu-id="6bf0d-179">**Collecter un package d’examen**: collecte des informations sur l’appareil dans un fichier ZIP.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-179">**Collect investigation package**—collects device information in a ZIP file.</span></span> [<span data-ttu-id="6bf0d-180">En savoir plus sur le package d’examen Microsoft Defender for Endpoint</span><span class="sxs-lookup"><span data-stu-id="6bf0d-180">Learn more about the Microsoft Defender for Endpoint investigation package</span></span>](/windows/security/threat-protection/microsoft-defender-atp/respond-machine-alerts#collect-investigation-package-from-devices)
- <span data-ttu-id="6bf0d-181">**Exécuter une analyse antivirus**: effectue une analyse complète Antivirus Windows Defender sur l’appareil</span><span class="sxs-lookup"><span data-stu-id="6bf0d-181">**Run antivirus scan**—performs a full Windows Defender Antivirus scan on the device</span></span>
- <span data-ttu-id="6bf0d-182">**Lancer une enquête**: lance une [enquête automatisée](m365d-autoir.md) sur l’appareil</span><span class="sxs-lookup"><span data-stu-id="6bf0d-182">**Initiate investigation**—initiates an [automated investigation](m365d-autoir.md) on the device</span></span>
- <span data-ttu-id="6bf0d-183">**Restreindre l’exécution de** l’application : définit des restrictions sur l’appareil pour autoriser uniquement l’exécution des fichiers signés avec un certificat émis par Microsoft.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-183">**Restrict app execution**—sets restrictions on device to allow only files that are signed with a Microsoft-issued certificate to run.</span></span> [<span data-ttu-id="6bf0d-184">En savoir plus sur les restrictions d’application avec Microsoft Defender pour le point de terminaison</span><span class="sxs-lookup"><span data-stu-id="6bf0d-184">Learn more about app restrictions with Microsoft Defender for Endpoint</span></span>](/microsoft-365/security/defender-endpoint/respond-machine-alerts#restrict-app-execution)

#### <a name="actions-on-files"></a><span data-ttu-id="6bf0d-185">Actions sur les fichiers</span><span class="sxs-lookup"><span data-stu-id="6bf0d-185">Actions on files</span></span>
<span data-ttu-id="6bf0d-186">Lorsqu’il est sélectionné, vous  pouvez choisir d’appliquer l’action de fichier de mise en quarantaine sur les fichiers dans la colonne , , ou dans la colonne des résultats `SHA1` de la `InitiatingProcessSHA1` `SHA256` `InitiatingProcessSHA256` requête.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-186">When selected, you can choose to apply the **Quarantine file** action on files in the `SHA1`, `InitiatingProcessSHA1`, `SHA256`, or `InitiatingProcessSHA256` column of the query results.</span></span> <span data-ttu-id="6bf0d-187">Cette action supprime le fichier de son emplacement actuel et place une copie en quarantaine.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-187">This action deletes the file from its current location and places a copy in quarantine.</span></span>

#### <a name="actions-on-users"></a><span data-ttu-id="6bf0d-188">Actions sur les utilisateurs</span><span class="sxs-lookup"><span data-stu-id="6bf0d-188">Actions on users</span></span>
<span data-ttu-id="6bf0d-189">Lorsqu’il est  sélectionné, l’utilisateur Marquer comme étant compromis est pris sur les utilisateurs dans la colonne , ou dans la colonne des résultats `AccountObjectId` de la `InitiatingProcessAccountObjectId` `RecipientObjectId` requête.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-189">When selected, the **Mark user as compromised** action is taken on users in the `AccountObjectId`, `InitiatingProcessAccountObjectId`, or `RecipientObjectId` column of the query results.</span></span> <span data-ttu-id="6bf0d-190">Cette action définit le niveau de risque des utilisateurs sur « élevé » Azure Active Directory, déclenchant les stratégies [de protection des identités correspondantes.](/azure/active-directory/identity-protection/overview-identity-protection)</span><span class="sxs-lookup"><span data-stu-id="6bf0d-190">This action sets the users risk level to "high" in Azure Active Directory, triggering corresponding [identity protection policies](/azure/active-directory/identity-protection/overview-identity-protection).</span></span>

> [!NOTE]
> <span data-ttu-id="6bf0d-191">L’action autoriser ou bloquer des règles de détection personnalisées n’est actuellement pas prise en charge sur Microsoft 365 Defender.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-191">The allow or block action for custom detection rules is currently not supported on Microsoft 365 Defender.</span></span>

### <a name="5-set-the-rule-scope"></a><span data-ttu-id="6bf0d-192">5. Définissez l’étendue de la règle.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-192">5. Set the rule scope.</span></span>
<span data-ttu-id="6bf0d-193">Définissez l’étendue pour spécifier les appareils couverts par la règle.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-193">Set the scope to specify which devices are covered by the rule.</span></span> <span data-ttu-id="6bf0d-194">L’étendue influence les règles qui vérifient les appareils et n’affecte pas les règles qui vérifient uniquement les boîtes aux lettres et les comptes d’utilisateurs ou les identités.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-194">The scope influences rules that check devices and doesn't affect rules that check only mailboxes and user accounts or identities.</span></span>

<span data-ttu-id="6bf0d-195">Lors de la définition de l’étendue, vous pouvez sélectionner :</span><span class="sxs-lookup"><span data-stu-id="6bf0d-195">When setting the scope, you can select:</span></span>

- <span data-ttu-id="6bf0d-196">Tous les appareils</span><span class="sxs-lookup"><span data-stu-id="6bf0d-196">All devices</span></span>
- <span data-ttu-id="6bf0d-197">Groupes d’appareils spécifiques</span><span class="sxs-lookup"><span data-stu-id="6bf0d-197">Specific device groups</span></span>

<span data-ttu-id="6bf0d-198">Seules les données des appareils dans l’étendue seront interrogés.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-198">Only data from devices in scope will be queried.</span></span> <span data-ttu-id="6bf0d-199">En outre, des actions seront prises uniquement sur ces appareils.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-199">Also, actions will be taken only on those devices.</span></span>

### <a name="6-review-and-turn-on-the-rule"></a><span data-ttu-id="6bf0d-200">6. Examinez et allumez la règle.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-200">6. Review and turn on the rule.</span></span>
<span data-ttu-id="6bf0d-201">Après avoir passé en revue la règle, **sélectionnez Créer** pour l’enregistrer.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-201">After reviewing the rule, select **Create** to save it.</span></span> <span data-ttu-id="6bf0d-202">La règle de détection personnalisée s’exécute immédiatement.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-202">The custom detection rule immediately runs.</span></span> <span data-ttu-id="6bf0d-203">Il s’exécute à nouveau en fonction de la fréquence configurée pour vérifier les correspondances, générer des alertes et prendre des mesures de réponse.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-203">It runs again based on configured frequency to check for matches, generate alerts, and take response actions.</span></span>


>[!Important] 
><span data-ttu-id="6bf0d-204">Les détections personnalisées doivent être régulièrement examinées pour des raisons d’efficacité et d’efficacité.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-204">Custom detections should be regularly reviewed for efficiency and effectiveness.</span></span> <span data-ttu-id="6bf0d-205">Pour vous assurer que vous créez des détections qui déclenchent de vraies alertes, prenez le temps de passer en revue vos détections personnalisées existantes en suivant les étapes de la procédure De gestion des règles de [détection personnalisées existantes.](#manage-existing-custom-detection-rules)</span><span class="sxs-lookup"><span data-stu-id="6bf0d-205">To make sure you are creating detections that trigger true alerts, take time to review your existing custom detections by following the steps in [Manage existing custom detection rules](#manage-existing-custom-detection-rules).</span></span> <br>  
<span data-ttu-id="6bf0d-206">Vous conservez le contrôle sur l’étendue ou la spécificité de vos détections personnalisées afin que les fausses alertes générées par les détections personnalisées indiquent la nécessité de modifier certains paramètres des règles.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-206">You maintain control over the broadness or specificity of your custom detections so any false alerts generated by custom detections might indicate a need to modify certain parameters of the rules.</span></span>


## <a name="manage-existing-custom-detection-rules"></a><span data-ttu-id="6bf0d-207">Gérer les règles de détection personnalisées existantes</span><span class="sxs-lookup"><span data-stu-id="6bf0d-207">Manage existing custom detection rules</span></span>
<span data-ttu-id="6bf0d-208">Vous pouvez afficher la liste des règles de détection personnalisées existantes, vérifier leurs précédentes séries et passer en revue les alertes qu’elles ont déclenchées.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-208">You can view the list of existing custom detection rules, check their previous runs, and review the alerts they have triggered.</span></span> <span data-ttu-id="6bf0d-209">Vous pouvez également exécuter une règle à la demande et la modifier.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-209">You can also run a rule on demand and modify it.</span></span>

>[!TIP]
> <span data-ttu-id="6bf0d-210">Les alertes détectées par des détections personnalisées sont disponibles sur les alertes et les API d’incident.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-210">Alerts raised by custom detections are available over alerts and incident APIs.</span></span> <span data-ttu-id="6bf0d-211">Pour plus d’informations, [consultez la Microsoft 365 API Defender.](api-supported.md)</span><span class="sxs-lookup"><span data-stu-id="6bf0d-211">For more information, see [Supported Microsoft 365 Defender APIs](api-supported.md).</span></span>

### <a name="view-existing-rules"></a><span data-ttu-id="6bf0d-212">Afficher les règles existantes</span><span class="sxs-lookup"><span data-stu-id="6bf0d-212">View existing rules</span></span>

<span data-ttu-id="6bf0d-213">Pour afficher toutes les règles de détection personnalisées existantes, **accédez à**  >  **Détections personnalisées de repérage.**</span><span class="sxs-lookup"><span data-stu-id="6bf0d-213">To view all existing custom detection rules, navigate to **Hunting** > **Custom detections**.</span></span> <span data-ttu-id="6bf0d-214">La page répertorie toutes les règles avec les informations d’exécuter suivantes :</span><span class="sxs-lookup"><span data-stu-id="6bf0d-214">The page lists all the rules with the following run information:</span></span>

- <span data-ttu-id="6bf0d-215">**Dernière série**: lorsqu’une règle a été exécuté pour la dernière fois pour vérifier les correspondances de requête et générer des alertes</span><span class="sxs-lookup"><span data-stu-id="6bf0d-215">**Last run**—when a rule was last run to check for query matches and generate alerts</span></span>
- <span data-ttu-id="6bf0d-216">**État de la dernière fois**: si une règle s’est correctement exécuté</span><span class="sxs-lookup"><span data-stu-id="6bf0d-216">**Last run status**—whether a rule ran successfully</span></span>
- <span data-ttu-id="6bf0d-217">**Next run**—the next scheduled run</span><span class="sxs-lookup"><span data-stu-id="6bf0d-217">**Next run**—the next scheduled run</span></span>
- <span data-ttu-id="6bf0d-218">**État**: si une règle a été allumée ou désactivée</span><span class="sxs-lookup"><span data-stu-id="6bf0d-218">**Status**—whether a rule has been turned on or off</span></span>

### <a name="view-rule-details-modify-rule-and-run-rule"></a><span data-ttu-id="6bf0d-219">Afficher les détails de la règle, modifier la règle et exécuter la règle</span><span class="sxs-lookup"><span data-stu-id="6bf0d-219">View rule details, modify rule, and run rule</span></span>

<span data-ttu-id="6bf0d-220">Pour afficher des informations complètes sur une règle de détection personnalisée, sélectionnez  >  **détections personnalisées** de repérage, puis sélectionnez le nom de la règle.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-220">To view comprehensive information about a custom detection rule, go to **Hunting** > **Custom detections** and then select the name of rule.</span></span> <span data-ttu-id="6bf0d-221">Vous pouvez ensuite afficher des informations générales sur la règle, notamment son état d’application et son étendue.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-221">You can then view general information about the rule, including information its run status and scope.</span></span> <span data-ttu-id="6bf0d-222">La page fournit également la liste des alertes et des actions déclenchées.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-222">The page also provides the list of triggered alerts and actions.</span></span>

<span data-ttu-id="6bf0d-223">![Page des détails des règles de détection personnalisées](../../media/custom-detection-details.png)</span><span class="sxs-lookup"><span data-stu-id="6bf0d-223">![Custom detection rule details page](../../media/custom-detection-details.png)</span></span><br>
<span data-ttu-id="6bf0d-224">*Détails des règles de détection personnalisées*</span><span class="sxs-lookup"><span data-stu-id="6bf0d-224">*Custom detection rule details*</span></span>

<span data-ttu-id="6bf0d-225">Vous pouvez également prendre les mesures suivantes sur la règle à partir de cette page :</span><span class="sxs-lookup"><span data-stu-id="6bf0d-225">You can also take the following actions on the rule from this page:</span></span>

- <span data-ttu-id="6bf0d-226">**Exécuter**: exécutez la règle immédiatement.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-226">**Run**—run the rule immediately.</span></span> <span data-ttu-id="6bf0d-227">Cela réinitialise également l’intervalle pour la prochaine suite.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-227">This also resets the interval for the next run.</span></span>
- <span data-ttu-id="6bf0d-228">**Modifier**— modifier la règle sans modifier la requête</span><span class="sxs-lookup"><span data-stu-id="6bf0d-228">**Edit**—modify the rule without changing the query</span></span>
- <span data-ttu-id="6bf0d-229">**Modifier la requête —** modifier la requête dans le recherche avancée</span><span class="sxs-lookup"><span data-stu-id="6bf0d-229">**Modify query**—edit the query in advanced hunting</span></span>
- <span data-ttu-id="6bf0d-230">**Activer**  /  **Désactiver :** activer la règle ou l’arrêter d’être en cours d’exécution</span><span class="sxs-lookup"><span data-stu-id="6bf0d-230">**Turn on** / **Turn off**—enable the rule or stop it from running</span></span>
- <span data-ttu-id="6bf0d-231">**Supprimer**: désactiver la règle et la supprimer</span><span class="sxs-lookup"><span data-stu-id="6bf0d-231">**Delete**—turn off the rule and remove it</span></span>

### <a name="view-and-manage-triggered-alerts"></a><span data-ttu-id="6bf0d-232">Afficher et gérer les alertes déclenchées</span><span class="sxs-lookup"><span data-stu-id="6bf0d-232">View and manage triggered alerts</span></span>

<span data-ttu-id="6bf0d-233">Dans l’écran détails de la règle (**Détections** personnalisées de repérage [nom de la règle] ), allez à  >    >   **Alertes déclenchées**, qui répertorie les alertes générées par des correspondances à la règle.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-233">In the rule details screen (**Hunting** > **Custom detections** > **[Rule name]**), go to  **Triggered alerts**, which lists the alerts generated by matches to the rule.</span></span> <span data-ttu-id="6bf0d-234">Sélectionnez une alerte pour afficher des informations détaillées à son sujet et prendre les mesures suivantes :</span><span class="sxs-lookup"><span data-stu-id="6bf0d-234">Select an alert to view detailed information about it and take the following actions:</span></span>

- <span data-ttu-id="6bf0d-235">Gérer l’alerte en setting its status and classification (true or false alert)</span><span class="sxs-lookup"><span data-stu-id="6bf0d-235">Manage the alert by setting its status and classification (true or false alert)</span></span>
- <span data-ttu-id="6bf0d-236">Lier l’alerte à un incident</span><span class="sxs-lookup"><span data-stu-id="6bf0d-236">Link the alert to an incident</span></span>
- <span data-ttu-id="6bf0d-237">Exécuter la requête qui a déclenché l’alerte sur le hunting avancé</span><span class="sxs-lookup"><span data-stu-id="6bf0d-237">Run the query that triggered the alert on advanced hunting</span></span>

### <a name="review-actions"></a><span data-ttu-id="6bf0d-238">Examiner les actions</span><span class="sxs-lookup"><span data-stu-id="6bf0d-238">Review actions</span></span>
<span data-ttu-id="6bf0d-239">Dans l’écran détails de la règle (**Détections** personnalisées de repérage [nom de la  >    >  **règle]**), allez à **Actions** déclenchées , qui répertorie les actions entreprises en fonction des correspondances à la règle.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-239">In the rule details screen (**Hunting** > **Custom detections** > **[Rule name]**), go to **Triggered actions**, which lists the actions taken based on matches to the rule.</span></span>

>[!TIP]
><span data-ttu-id="6bf0d-240">Pour afficher rapidement des informations et agir sur un élément d’un tableau, utilisez la colonne de sélection [&#10003;] à gauche du tableau.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-240">To quickly view information and take action on an item in a table, use the selection column [&#10003;] at the left of the table.</span></span>

>[!NOTE]
><span data-ttu-id="6bf0d-241">Certaines colonnes de cet article peuvent ne pas être disponibles dans Microsoft Defender pour endpoint.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-241">Some columns in this article might not be available in Microsoft Defender for Endpoint.</span></span> <span data-ttu-id="6bf0d-242">[Activer Microsoft 365 Defender pour qu’il](m365d-enable.md) recherche les menaces à l’aide de sources de données plus nombreuses.</span><span class="sxs-lookup"><span data-stu-id="6bf0d-242">[Turn on Microsoft 365 Defender](m365d-enable.md) to hunt for threats using more data sources.</span></span> <span data-ttu-id="6bf0d-243">Vous pouvez déplacer vos flux de travail de recherche avancée de Microsoft Defender pour point de terminaison vers Microsoft 365 Defender en suivant les étapes de la procédure de migration des requêtes de recherche avancée à partir de Microsoft Defender pour le point de [terminaison.](advanced-hunting-migrate-from-mde.md)</span><span class="sxs-lookup"><span data-stu-id="6bf0d-243">You can move your advanced hunting workflows from Microsoft Defender for Endpoint to Microsoft 365 Defender by following the steps in [Migrate advanced hunting queries from Microsoft Defender for Endpoint](advanced-hunting-migrate-from-mde.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="6bf0d-244">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="6bf0d-244">See also</span></span>
- [<span data-ttu-id="6bf0d-245">Vue d’ensemble des détections personnalisées</span><span class="sxs-lookup"><span data-stu-id="6bf0d-245">Custom detections overview</span></span>](custom-detections-overview.md)
- [<span data-ttu-id="6bf0d-246">Vue d’ensemble du repérage avancé</span><span class="sxs-lookup"><span data-stu-id="6bf0d-246">Advanced hunting overview</span></span>](advanced-hunting-overview.md)
- [<span data-ttu-id="6bf0d-247">Découvrir le langage de requête de repérage avancé</span><span class="sxs-lookup"><span data-stu-id="6bf0d-247">Learn the advanced hunting query language</span></span>](advanced-hunting-query-language.md)
- [<span data-ttu-id="6bf0d-248">Migrer des requêtes de recherche avancée à partir de Microsoft Defender pour le point de terminaison</span><span class="sxs-lookup"><span data-stu-id="6bf0d-248">Migrate advanced hunting queries from Microsoft Defender for Endpoint</span></span>](advanced-hunting-migrate-from-mde.md)
