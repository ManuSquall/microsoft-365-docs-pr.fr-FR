---
title: Créer et gérer des règles de détection personnalisées dans Microsoft Threat Protection
description: Découvrez comment créer et gérer des règles de détection personnalisées sur la base de requêtes de chasse avancées.
keywords: chasse de menace, recherche de menace, recherche de menace informatique, protection contre les menaces Microsoft, Microsoft 365, MTP, M365, recherche, requête, télémétrie, détections personnalisées, règles, schéma, Kusto, Microsoft 365, protection contre les menaces Microsoft, RBAC, autorisations, Microsoft Defender ATP
search.product: eADQiWindows 10XVcnh
search.appverid: met150
ms.prod: microsoft-365-enterprise
ms.mktglfcycl: deploy
ms.sitesec: library
ms.pagetype: security
f1.keywords:
- NOCSH
ms.author: lomayor
author: lomayor
ms.localizationpriority: medium
manager: dansimp
audience: ITPro
ms.collection: M365-security-compliance
ms.topic: article
ms.openlocfilehash: f6c00ef68b59f900882f662e33f8e9cf3e08e170
ms.sourcegitcommit: 41fd71ec7175ea3b94f5d3ea1ae2c8fb8dc84227
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/09/2020
ms.locfileid: "47419155"
---
# <a name="create-and-manage-custom-detections-rules"></a><span data-ttu-id="69a29-104">Créer et gérer des règles de détection personnalisées</span><span class="sxs-lookup"><span data-stu-id="69a29-104">Create and manage custom detections rules</span></span>

<span data-ttu-id="69a29-105">**S’applique à :**</span><span class="sxs-lookup"><span data-stu-id="69a29-105">**Applies to:**</span></span>
- <span data-ttu-id="69a29-106">Protection Microsoft contre les menaces</span><span class="sxs-lookup"><span data-stu-id="69a29-106">Microsoft Threat Protection</span></span>

<span data-ttu-id="69a29-107">Les règles de détection personnalisées sont des règles que vous pouvez concevoir et ajuster à l’aide de requêtes de [chasse avancées](advanced-hunting-overview.md) .</span><span class="sxs-lookup"><span data-stu-id="69a29-107">Custom detection rules are rules you can design and tweak using [advanced hunting](advanced-hunting-overview.md) queries.</span></span> <span data-ttu-id="69a29-108">Ces règles vous permettent de surveiller de manière proactive divers événements et États du système, y compris l’activité de violation présumée et les points de terminaison mal configurés.</span><span class="sxs-lookup"><span data-stu-id="69a29-108">These rules let you proactively monitor various events and system states, including suspected breach activity and misconfigured endpoints.</span></span> <span data-ttu-id="69a29-109">Vous pouvez les configurer pour qu’elles s’exécutent à intervalles réguliers, générant des alertes et en prenant des mesures de réponse chaque fois qu’il y a des correspondances.</span><span class="sxs-lookup"><span data-stu-id="69a29-109">You can set them to run at regular intervals, generating alerts and taking response actions whenever there are matches.</span></span>

## <a name="required-permissions-for-managing-custom-detections"></a><span data-ttu-id="69a29-110">Autorisations requises pour la gestion des détections personnalisées</span><span class="sxs-lookup"><span data-stu-id="69a29-110">Required permissions for managing custom detections</span></span>

<span data-ttu-id="69a29-111">Pour gérer les détections personnalisées, vous devez disposer de l’un des rôles suivants :</span><span class="sxs-lookup"><span data-stu-id="69a29-111">To manage custom detections, you need to be assigned one of these roles:</span></span>

- <span data-ttu-id="69a29-112">**Administrateur de sécurité**: les utilisateurs disposant de ce [rôle Azure Active Directory](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-assign-admin-roles#security-administrator) peuvent gérer les paramètres de sécurité dans le centre de sécurité Microsoft 365 et d’autres portails et services.</span><span class="sxs-lookup"><span data-stu-id="69a29-112">**Security administrator**—Users with this [Azure Active Directory role](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-assign-admin-roles#security-administrator) can manage security settings in Microsoft 365 security center and other portals and services.</span></span>

- <span data-ttu-id="69a29-113">**Opérateur de sécurité**: les utilisateurs disposant de ce [rôle Azure Active Directory](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-assign-admin-roles#security-administrator) peuvent gérer les alertes et disposer d’un accès global en lecture seule aux fonctionnalités liées à la sécurité, y compris toutes les informations du centre de sécurité Microsoft 365.</span><span class="sxs-lookup"><span data-stu-id="69a29-113">**Security operator**—Users with this [Azure Active Directory role](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-assign-admin-roles#security-administrator) can manage alerts and have global read-only access to security-related features, including all information in Microsoft 365 security center.</span></span> <span data-ttu-id="69a29-114">Ce rôle est suffisant pour la gestion des détections personnalisées uniquement si le contrôle d’accès basé sur un rôle (RBAC) est désactivé dans Microsoft Defender ATP.</span><span class="sxs-lookup"><span data-stu-id="69a29-114">This role is sufficient for managing custom detections only if role-based access control (RBAC) is turned off in Microsoft Defender ATP.</span></span> <span data-ttu-id="69a29-115">Si RBAC est configuré, vous avez également besoin de l’autorisation **gérer les paramètres de sécurité** pour Microsoft Defender ATP.</span><span class="sxs-lookup"><span data-stu-id="69a29-115">If you have RBAC configured, you also need the **manage security settings** permission for Microsoft Defender ATP.</span></span>

<span data-ttu-id="69a29-116">Pour gérer les autorisations requises, un **administrateur général** peut :</span><span class="sxs-lookup"><span data-stu-id="69a29-116">To manage required permissions, a **global administrator** can:</span></span>

- <span data-ttu-id="69a29-117">Attribuez le rôle **administrateur** de sécurité ou **opérateur de sécurité** dans le [Centre d’administration Microsoft 365](https://admin.microsoft.com/) sous **rôles**de l’administrateur de la  >  **sécurité**.</span><span class="sxs-lookup"><span data-stu-id="69a29-117">Assign the **security administrator** or **security operator** role in [Microsoft 365 admin center](https://admin.microsoft.com/) under **Roles** > **Security admin**.</span></span>
- <span data-ttu-id="69a29-118">Vérifiez les paramètres RBAC pour Microsoft Defender ATP dans le [Centre de sécurité Microsoft Defender](https://securitycenter.windows.com/) **sous**  >  **Permissions**  >  **rôles**des autorisations.</span><span class="sxs-lookup"><span data-stu-id="69a29-118">Check RBAC settings for Microsoft Defender ATP in [Microsoft Defender Security Center](https://securitycenter.windows.com/) under **Settings** > **Permissions** > **Roles**.</span></span> <span data-ttu-id="69a29-119">Sélectionnez le rôle correspondant pour attribuer l’autorisation **gérer les paramètres de sécurité** .</span><span class="sxs-lookup"><span data-stu-id="69a29-119">Select the corresponding role to assign the **manage security settings** permission.</span></span>

> [!NOTE]
> <span data-ttu-id="69a29-120">Pour gérer les détections personnalisées, les **opérateurs de sécurité** doivent disposer de l’autorisation **gérer les paramètres de sécurité** dans Microsoft Defender ATP si le RBAC est activé.</span><span class="sxs-lookup"><span data-stu-id="69a29-120">To manage custom detections, **security operators** will need the **manage security settings** permission in Microsoft Defender ATP if RBAC is turned on.</span></span>

## <a name="create-a-custom-detection-rule"></a><span data-ttu-id="69a29-121">Créer une règle de détection personnalisée</span><span class="sxs-lookup"><span data-stu-id="69a29-121">Create a custom detection rule</span></span>
### <a name="1-prepare-the-query"></a><span data-ttu-id="69a29-122">1. Préparez la requête.</span><span class="sxs-lookup"><span data-stu-id="69a29-122">1. Prepare the query.</span></span>

<span data-ttu-id="69a29-123">Dans le centre de sécurité Microsoft 365, accédez à la **chasse avancée** et sélectionnez une requête existante ou créez une nouvelle requête.</span><span class="sxs-lookup"><span data-stu-id="69a29-123">In Microsoft 365 security center, go to **Advanced hunting** and select an existing query or create a new query.</span></span> <span data-ttu-id="69a29-124">Lors de l’utilisation d’une nouvelle requête, exécutez la requête pour identifier les erreurs et comprendre les résultats possibles.</span><span class="sxs-lookup"><span data-stu-id="69a29-124">When using a new query, run the query to identify errors and understand possible results.</span></span>

>[!IMPORTANT]
><span data-ttu-id="69a29-125">Pour empêcher le service de renvoyer un trop grand nombre d’alertes, chaque règle est limitée à la génération de seulement 100 alertes chaque fois qu’elle est exécutée.</span><span class="sxs-lookup"><span data-stu-id="69a29-125">To prevent the service from returning too many alerts, each rule is limited to generating only 100 alerts whenever it runs.</span></span> <span data-ttu-id="69a29-126">Avant de créer une règle, affinez votre requête afin d’éviter les alertes pour l’activité quotidienne normale.</span><span class="sxs-lookup"><span data-stu-id="69a29-126">Before creating a rule, tweak your query to avoid alerting for normal, day-to-day activity.</span></span>


#### <a name="required-columns-in-the-query-results"></a><span data-ttu-id="69a29-127">Colonnes requises dans les résultats de la requête</span><span class="sxs-lookup"><span data-stu-id="69a29-127">Required columns in the query results</span></span>
<span data-ttu-id="69a29-128">Pour créer une règle de détection personnalisée, la requête doit renvoyer les colonnes suivantes :</span><span class="sxs-lookup"><span data-stu-id="69a29-128">To create a custom detection rule, the query must return the following columns:</span></span>

- <span data-ttu-id="69a29-129">`Timestamp`: permet de définir l’horodatage pour les alertes générées.</span><span class="sxs-lookup"><span data-stu-id="69a29-129">`Timestamp`—used to set the timestamp for generated alerts</span></span>
- <span data-ttu-id="69a29-130">`ReportId`— active les recherches des enregistrements d’origine</span><span class="sxs-lookup"><span data-stu-id="69a29-130">`ReportId`—enables lookups for the original records</span></span>
- <span data-ttu-id="69a29-131">Une des colonnes suivantes qui identifient des appareils, des utilisateurs ou des boîtes aux lettres spécifiques :</span><span class="sxs-lookup"><span data-stu-id="69a29-131">One of the following columns that identify specific devices, users, or mailboxes:</span></span>
    - `DeviceId`
    - `DeviceName`
    - `RemoteDeviceName`
    - `RecipientEmailAddress`
    - <span data-ttu-id="69a29-132">`SenderFromAddress` (adresse d’expéditeur ou de chemin d’accès de retour)</span><span class="sxs-lookup"><span data-stu-id="69a29-132">`SenderFromAddress` (envelope sender or Return-Path address)</span></span>
    - <span data-ttu-id="69a29-133">`SenderMailFromAddress` (adresse de l’expéditeur affichée par le client de messagerie)</span><span class="sxs-lookup"><span data-stu-id="69a29-133">`SenderMailFromAddress` (sender address displayed by email client)</span></span>
    - `RecipientObjectId`
    - `AccountObjectId`
    - `AccountSid`
    - `AccountUpn`
    - `InitiatingProcessAccountSid`
    - `InitiatingProcessAccountUpn`
    - `InitiatingProcessAccountObjectId`

>[!NOTE]
><span data-ttu-id="69a29-134">Une prise en charge des entités supplémentaires sera ajoutée au fur et à mesure que de nouvelles tables seront ajoutées au [schéma de chasse avancé](advanced-hunting-schema-tables.md).</span><span class="sxs-lookup"><span data-stu-id="69a29-134">Support for additional entities will be added as new tables are added to the [advanced hunting schema](advanced-hunting-schema-tables.md).</span></span>

<span data-ttu-id="69a29-135">Les requêtes simples, telles que celles qui n’utilisent pas l' `project` `summarize` opérateur ou pour personnaliser ou agréger des résultats, renvoient généralement ces colonnes communes.</span><span class="sxs-lookup"><span data-stu-id="69a29-135">Simple queries, such as those that don't use the `project` or `summarize` operator to customize or aggregate results, typically return these common columns.</span></span>

<span data-ttu-id="69a29-136">Il existe plusieurs façons de s’assurer que les requêtes plus complexes renvoient ces colonnes.</span><span class="sxs-lookup"><span data-stu-id="69a29-136">There are various ways to ensure more complex queries return these columns.</span></span> <span data-ttu-id="69a29-137">Par exemple, si vous préférez agréger et dénombrer par entité sous une colonne telle que `DeviceId` , vous pouvez toujours renvoyer `Timestamp` et `ReportId` en obtenant l’événement le plus récent impliquant chacun d’eux `DeviceId` .</span><span class="sxs-lookup"><span data-stu-id="69a29-137">For example, if you prefer to aggregate and count by entity under a column such as `DeviceId`, you can still return `Timestamp` and `ReportId` by getting it from the most recent event involving each unique `DeviceId`.</span></span>

<span data-ttu-id="69a29-138">La requête d’exemple ci-dessous compte le nombre d’appareils uniques ( `DeviceId` ) avec des détections d’antivirus et utilise ce nombre pour rechercher uniquement les appareils comportant plus de cinq détections.</span><span class="sxs-lookup"><span data-stu-id="69a29-138">The sample query below counts the number of unique devices (`DeviceId`) with antivirus detections and uses this count to find only the devices with more than five detections.</span></span> <span data-ttu-id="69a29-139">Pour renvoyer la dernière `Timestamp` et la dernière correspondantes `ReportId` , elle utilise l' `summarize` opérateur avec la `arg_max` fonction.</span><span class="sxs-lookup"><span data-stu-id="69a29-139">To return the latest `Timestamp` and the corresponding `ReportId`, it uses the `summarize` operator with the `arg_max` function.</span></span>

```kusto
DeviceEvents
| where Timestamp > ago(1d)
| where ActionType == "AntivirusDetection"
| summarize (Timestamp, ReportId)=arg_max(Timestamp, ReportId), count() by DeviceId
| where count_ > 5
```

> [!TIP]
> <span data-ttu-id="69a29-140">Pour obtenir de meilleures performances de requête, définissez un filtre de temps qui correspond à la fréquence d’exécution prévue pour la règle.</span><span class="sxs-lookup"><span data-stu-id="69a29-140">For better query performance, set a time filter that matches your intended run frequency for the rule.</span></span> <span data-ttu-id="69a29-141">Étant donné que l’exécution la moins fréquente est effectuée _toutes les 24 heures_, le filtrage du jour précédent concerne toutes les nouvelles données.</span><span class="sxs-lookup"><span data-stu-id="69a29-141">Since the least frequent run is _every 24 hours_, filtering for the past day will cover all new data.</span></span>

### <a name="2-create-new-rule-and-provide-alert-details"></a><span data-ttu-id="69a29-142">2. créer une règle et fournir des détails d’alerte.</span><span class="sxs-lookup"><span data-stu-id="69a29-142">2. Create new rule and provide alert details.</span></span>

<span data-ttu-id="69a29-143">À l’aide de la requête dans l’éditeur de requête, sélectionnez **créer une règle de détection** et spécifiez les détails d’alerte suivants :</span><span class="sxs-lookup"><span data-stu-id="69a29-143">With the query in the query editor, select **Create detection rule** and specify the following alert details:</span></span>

- <span data-ttu-id="69a29-144">**Nom**de la détection : nom de la règle de détection</span><span class="sxs-lookup"><span data-stu-id="69a29-144">**Detection name**—name of the detection rule</span></span>
- <span data-ttu-id="69a29-145">**Fréquence**: intervalle d’exécution de la requête et d’exécution de l’action.</span><span class="sxs-lookup"><span data-stu-id="69a29-145">**Frequency**—interval for running the query and taking action.</span></span> [<span data-ttu-id="69a29-146">Consultez les conseils supplémentaires ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="69a29-146">See additional guidance below</span></span>](#rule-frequency)
- <span data-ttu-id="69a29-147">**Titre**de l’alerte — titre affiché avec des alertes déclenchées par la règle</span><span class="sxs-lookup"><span data-stu-id="69a29-147">**Alert title**—title displayed with alerts triggered by the rule</span></span>
- <span data-ttu-id="69a29-148">**Gravité**— risque potentiel de l’activité ou du composant identifié par la règle</span><span class="sxs-lookup"><span data-stu-id="69a29-148">**Severity**—potential risk of the component or activity identified by the rule</span></span>
- <span data-ttu-id="69a29-149">**Catégorie**— composant de menace ou activité identifiée par la règle</span><span class="sxs-lookup"><span data-stu-id="69a29-149">**Category**—threat component or activity identified by the rule</span></span>
- <span data-ttu-id="69a29-150">**Mitre att&CK techniques**: une ou plusieurs techniques d’attaque identifiées par la règle comme indiqué dans la [Mitre att&CK Framework](https://attack.mitre.org/).</span><span class="sxs-lookup"><span data-stu-id="69a29-150">**MITRE ATT&CK techniques**—one or more attack techniques identified by the rule as documented in the [MITRE ATT&CK framework](https://attack.mitre.org/).</span></span> <span data-ttu-id="69a29-151">Cette section est masquée pour certaines catégories d’alertes, y compris les programmes malveillants, les ransomware, les activités suspectes et les logiciels indésirables.</span><span class="sxs-lookup"><span data-stu-id="69a29-151">This section is hidden for certain alert categories, including malware, ransomware, suspicious activity, and unwanted software</span></span>
- <span data-ttu-id="69a29-152">**Description**: plus d’informations sur le composant ou l’activité identifié par la règle</span><span class="sxs-lookup"><span data-stu-id="69a29-152">**Description**—more information about the component or activity identified by the rule</span></span> 
- <span data-ttu-id="69a29-153">**Actions recommandées**: actions supplémentaires que les répondeurs peuvent entreprendre en réponse à une alerte</span><span class="sxs-lookup"><span data-stu-id="69a29-153">**Recommended actions**—additional actions that responders might take in response to an alert</span></span>

#### <a name="rule-frequency"></a><span data-ttu-id="69a29-154">Fréquence de la règle</span><span class="sxs-lookup"><span data-stu-id="69a29-154">Rule frequency</span></span>
<span data-ttu-id="69a29-155">Lors de l’enregistrement ou de la modification d’une nouvelle règle, celle-ci s’exécute et recherche des correspondances au cours des 30 derniers jours de données.</span><span class="sxs-lookup"><span data-stu-id="69a29-155">When you save or edit a new rule, it runs and checks for matches from the past 30 days of data.</span></span> <span data-ttu-id="69a29-156">La règle s’exécute à nouveau à intervalles fixes, appliquant une durée lookback en fonction de la fréquence choisie :</span><span class="sxs-lookup"><span data-stu-id="69a29-156">The rule then runs again at fixed intervals, applying a lookback duration based on the frequency you choose:</span></span>

- <span data-ttu-id="69a29-157">**Toutes les 24 heures**– s’exécute toutes les 24 heures, vérification des données des 30 derniers jours</span><span class="sxs-lookup"><span data-stu-id="69a29-157">**Every 24 hours**—runs every 24 hours, checking data from the past 30 days</span></span>
- <span data-ttu-id="69a29-158">**Toutes les 12 heures**— s’exécute toutes les 12 heures, en vérifiant les données des 24 dernières heures</span><span class="sxs-lookup"><span data-stu-id="69a29-158">**Every 12 hours**—runs every 12 hours, checking data from the past 24 hours</span></span>
- <span data-ttu-id="69a29-159">**Toutes les 3 heures**— s’exécute toutes les 3 heures, en vérifiant les données des 6 dernières heures</span><span class="sxs-lookup"><span data-stu-id="69a29-159">**Every 3 hours**—runs every 3 hours, checking data from the past 6 hours</span></span>
- <span data-ttu-id="69a29-160">**Toutes les heures**— s’exécute toutes les heures, en vérifiant les données des 2 dernières heures</span><span class="sxs-lookup"><span data-stu-id="69a29-160">**Every hour**—runs hourly, checking data from the past 2 hours</span></span>

>[!TIP]
> <span data-ttu-id="69a29-161">Associez les filtres de temps de votre requête à la durée lookback.</span><span class="sxs-lookup"><span data-stu-id="69a29-161">Match the time filters in your query with the lookback duration.</span></span> <span data-ttu-id="69a29-162">Les résultats en dehors de la durée lookback sont ignorés.</span><span class="sxs-lookup"><span data-stu-id="69a29-162">Results outside of the lookback duration are ignored.</span></span>  

<span data-ttu-id="69a29-163">Sélectionnez la fréquence correspondant à la fréquence à laquelle vous souhaitez surveiller les détections.</span><span class="sxs-lookup"><span data-stu-id="69a29-163">Select the frequency that matches how closely you want to monitor detections.</span></span> <span data-ttu-id="69a29-164">Tenez compte de la capacité de votre organisation à répondre aux alertes.</span><span class="sxs-lookup"><span data-stu-id="69a29-164">Consider your organization's capacity to respond to the alerts.</span></span>

### <a name="3-choose-the-impacted-entities"></a><span data-ttu-id="69a29-165">3. Choisissez les entités concernées.</span><span class="sxs-lookup"><span data-stu-id="69a29-165">3. Choose the impacted entities.</span></span>
<span data-ttu-id="69a29-166">Identifiez les colonnes de vos résultats de requête où vous vous attendez à trouver l’entité principale affectée ou concernée.</span><span class="sxs-lookup"><span data-stu-id="69a29-166">Identify the columns in your query results where you expect to find the main affected or impacted entity.</span></span> <span data-ttu-id="69a29-167">Par exemple, une requête peut renvoyer des adresses d’expéditeur ( `SenderFromAddress` ou `SenderMailFromAddress` ) et de destinataire ( `RecipientEmailAddress` ).</span><span class="sxs-lookup"><span data-stu-id="69a29-167">For example, a query might return sender (`SenderFromAddress` or `SenderMailFromAddress`) and recipient (`RecipientEmailAddress`) addresses.</span></span> <span data-ttu-id="69a29-168">L’identification de l’une de ces colonnes qui représente l’entité affectée principale aide le service à agréger les alertes appropriées, à corréler les incidents et à cibler les actions de réponse.</span><span class="sxs-lookup"><span data-stu-id="69a29-168">Identifying which of these columns represent the main impacted entity helps the service aggregate relevant alerts, correlate incidents, and target response actions.</span></span>

<span data-ttu-id="69a29-169">Vous pouvez sélectionner une seule colonne pour chaque type d’entité (boîte aux lettres, utilisateur ou appareil).</span><span class="sxs-lookup"><span data-stu-id="69a29-169">You can select only one column for each entity type (mailbox, user, or device).</span></span> <span data-ttu-id="69a29-170">Les colonnes qui ne sont pas renvoyées par votre requête ne peuvent pas être sélectionnées.</span><span class="sxs-lookup"><span data-stu-id="69a29-170">Columns that are not returned by your query can't be selected.</span></span>

### <a name="4-specify-actions"></a><span data-ttu-id="69a29-171">4. spécifiez les actions.</span><span class="sxs-lookup"><span data-stu-id="69a29-171">4. Specify actions.</span></span>
<span data-ttu-id="69a29-172">Votre règle de détection personnalisée peut effectuer automatiquement des actions sur les appareils, les fichiers ou les utilisateurs qui sont renvoyés par la requête.</span><span class="sxs-lookup"><span data-stu-id="69a29-172">Your custom detection rule can automatically take actions on devices, files, or users that are returned by the query.</span></span>

#### <a name="actions-on-devices"></a><span data-ttu-id="69a29-173">Actions sur les appareils</span><span class="sxs-lookup"><span data-stu-id="69a29-173">Actions on devices</span></span>
<span data-ttu-id="69a29-174">Ces actions sont appliquées aux appareils dans la `DeviceId` colonne des résultats de la requête :</span><span class="sxs-lookup"><span data-stu-id="69a29-174">These actions are applied to devices in the `DeviceId` column of the query results:</span></span>
- <span data-ttu-id="69a29-175">**Appareil isolé**: utilise Microsoft Defender ATP pour appliquer l’isolement réseau complet, ce qui empêche l’appareil de se connecter à une application ou à un service.</span><span class="sxs-lookup"><span data-stu-id="69a29-175">**Isolate device**—uses Microsoft Defender ATP to apply full network isolation, preventing the device from connecting to any application or service.</span></span> [<span data-ttu-id="69a29-176">En savoir plus sur l’isolation de l’ordinateur Microsoft Defender ATP</span><span class="sxs-lookup"><span data-stu-id="69a29-176">Learn more about Microsoft Defender ATP machine isolation</span></span>](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/respond-machine-alerts#isolate-devices-from-the-network)
- <span data-ttu-id="69a29-177">**Package d’enquête de collecte**— recueille des informations sur les périphériques dans un fichier zip.</span><span class="sxs-lookup"><span data-stu-id="69a29-177">**Collect investigation package**—collects device information in a ZIP file.</span></span> [<span data-ttu-id="69a29-178">En savoir plus sur le package d’enquête Microsoft Defender ATP</span><span class="sxs-lookup"><span data-stu-id="69a29-178">Learn more about the Microsoft Defender ATP investigation package</span></span>](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/respond-machine-alerts#collect-investigation-package-from-devices)
- <span data-ttu-id="69a29-179">**Exécuter l’analyse antivirus**: effectue une analyse complète de l’antivirus Windows Defender sur l’appareil.</span><span class="sxs-lookup"><span data-stu-id="69a29-179">**Run antivirus scan**—performs a full Windows Defender Antivirus scan on the device</span></span>
- <span data-ttu-id="69a29-180">**Lancer une enquête**: lance une [enquête automatisée](mtp-autoir.md) sur l’appareil.</span><span class="sxs-lookup"><span data-stu-id="69a29-180">**Initiate investigation**—initiates an [automated investigation](mtp-autoir.md) on the device</span></span>
- <span data-ttu-id="69a29-181">**Limiter l’exécution de l’application**: définit des restrictions sur l’appareil pour autoriser uniquement les fichiers signés avec un certificat émis par Microsoft à exécuter.</span><span class="sxs-lookup"><span data-stu-id="69a29-181">**Restrict app execution**—sets restrictions on device to allow only files that are signed with a Microsoft-issued certificate to run.</span></span> [<span data-ttu-id="69a29-182">En savoir plus sur les restrictions d’application avec Microsoft Defender ATP</span><span class="sxs-lookup"><span data-stu-id="69a29-182">Learn more about app restrictions with Microsoft Defender ATP</span></span>](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/respond-machine-alerts#restrict-app-execution)

#### <a name="actions-on-files"></a><span data-ttu-id="69a29-183">Actions sur les fichiers</span><span class="sxs-lookup"><span data-stu-id="69a29-183">Actions on files</span></span>
<span data-ttu-id="69a29-184">Lorsque cette option est sélectionnée, vous pouvez choisir d’appliquer l’action de **mise en quarantaine** sur les fichiers dans la `SHA1` colonne,, `InitiatingProcessSHA1` `SHA256` ou `InitiatingProcessSHA256` des résultats de la requête.</span><span class="sxs-lookup"><span data-stu-id="69a29-184">When selected, you can choose to apply the **Quarantine file** action on files in the `SHA1`, `InitiatingProcessSHA1`, `SHA256`, or `InitiatingProcessSHA256` column of the query results.</span></span> <span data-ttu-id="69a29-185">Cette action supprime le fichier de son emplacement actuel et place une copie en quarantaine.</span><span class="sxs-lookup"><span data-stu-id="69a29-185">This action deletes the file from its current location and places a copy in quarantine.</span></span>

#### <a name="actions-on-users"></a><span data-ttu-id="69a29-186">Actions sur les utilisateurs</span><span class="sxs-lookup"><span data-stu-id="69a29-186">Actions on users</span></span>
<span data-ttu-id="69a29-187">Lorsque cette option est sélectionnée, l’action **marquer l’utilisateur comme compromis** est effectuée sur les utilisateurs dans la `AccountObjectId` `InitiatingProcessAccountObjectId` colonne, ou `RecipientObjectId` des résultats de la requête.</span><span class="sxs-lookup"><span data-stu-id="69a29-187">When selected, the **Mark user as compromised** action is taken on users in the `AccountObjectId`, `InitiatingProcessAccountObjectId`, or `RecipientObjectId` column of the query results.</span></span> <span data-ttu-id="69a29-188">Cette action définit le niveau de risque de l’utilisateur sur « élevé » dans Azure Active Directory, en déclenchant des [stratégies de protection des identités](https://docs.microsoft.com/azure/active-directory/identity-protection/overview-identity-protection)correspondantes.</span><span class="sxs-lookup"><span data-stu-id="69a29-188">This action sets the users risk level to "high" in Azure Active Directory, triggering corresponding [identity protection policies](https://docs.microsoft.com/azure/active-directory/identity-protection/overview-identity-protection).</span></span>

> [!NOTE]
> <span data-ttu-id="69a29-189">L’action autoriser ou bloquer pour les règles de détection personnalisées n’est pas prise en charge actuellement sur la protection contre les menaces Microsoft.</span><span class="sxs-lookup"><span data-stu-id="69a29-189">The allow or block action for custom detection rules is currently not supported on Microsoft Threat Protection.</span></span>

### <a name="5-set-the-rule-scope"></a><span data-ttu-id="69a29-190">5. définir l’étendue de la règle.</span><span class="sxs-lookup"><span data-stu-id="69a29-190">5. Set the rule scope.</span></span>
<span data-ttu-id="69a29-191">Définissez l’étendue pour spécifier les appareils couverts par la règle.</span><span class="sxs-lookup"><span data-stu-id="69a29-191">Set the scope to specify which devices are covered by the rule.</span></span> <span data-ttu-id="69a29-192">L’étendue influe sur les règles qui vérifient les périphériques et n’affecte pas les règles qui vérifient uniquement les boîtes aux lettres et les comptes d’utilisateur ou les identités.</span><span class="sxs-lookup"><span data-stu-id="69a29-192">The scope influences rules that check devices and doesn't affect rules that check only mailboxes and user accounts or identities.</span></span>

<span data-ttu-id="69a29-193">Lors de la définition de l’étendue, vous pouvez sélectionner :</span><span class="sxs-lookup"><span data-stu-id="69a29-193">When setting the scope, you can select:</span></span>

- <span data-ttu-id="69a29-194">Tous les appareils</span><span class="sxs-lookup"><span data-stu-id="69a29-194">All devices</span></span>
- <span data-ttu-id="69a29-195">Groupes d’appareils spécifiques</span><span class="sxs-lookup"><span data-stu-id="69a29-195">Specific device groups</span></span>

<span data-ttu-id="69a29-196">Seules les données provenant d’appareils dans l’étendue seront interrogées.</span><span class="sxs-lookup"><span data-stu-id="69a29-196">Only data from devices in scope will be queried.</span></span> <span data-ttu-id="69a29-197">En outre, les actions ne seront effectuées que sur ces appareils.</span><span class="sxs-lookup"><span data-stu-id="69a29-197">Also, actions will be taken only on those devices.</span></span>

### <a name="6-review-and-turn-on-the-rule"></a><span data-ttu-id="69a29-198">6. Vérifiez et activez la règle.</span><span class="sxs-lookup"><span data-stu-id="69a29-198">6. Review and turn on the rule.</span></span>
<span data-ttu-id="69a29-199">Après avoir examiné la règle, sélectionnez **créer** pour l’enregistrer.</span><span class="sxs-lookup"><span data-stu-id="69a29-199">After reviewing the rule, select **Create** to save it.</span></span> <span data-ttu-id="69a29-200">La règle de détection personnalisée s’exécute immédiatement.</span><span class="sxs-lookup"><span data-stu-id="69a29-200">The custom detection rule immediately runs.</span></span> <span data-ttu-id="69a29-201">Il s’exécute à nouveau en fonction de la fréquence configurée pour vérifier les correspondances, générer des alertes et prendre des mesures de réponse.</span><span class="sxs-lookup"><span data-stu-id="69a29-201">It runs again based on configured frequency to check for matches, generate alerts, and take response actions.</span></span>

## <a name="manage-existing-custom-detection-rules"></a><span data-ttu-id="69a29-202">Gérer les règles de détection personnalisées existantes</span><span class="sxs-lookup"><span data-stu-id="69a29-202">Manage existing custom detection rules</span></span>
<span data-ttu-id="69a29-203">Vous pouvez afficher la liste des règles de détection personnalisées existantes, vérifier leurs exécutions précédentes et examiner les alertes qu’elles ont déclenchées.</span><span class="sxs-lookup"><span data-stu-id="69a29-203">You can view the list of existing custom detection rules, check their previous runs, and review the alerts they have triggered.</span></span> <span data-ttu-id="69a29-204">Vous pouvez également exécuter une règle à la demande et la modifier.</span><span class="sxs-lookup"><span data-stu-id="69a29-204">You can also run a rule on demand and modify it.</span></span>

### <a name="view-existing-rules"></a><span data-ttu-id="69a29-205">Afficher les règles existantes</span><span class="sxs-lookup"><span data-stu-id="69a29-205">View existing rules</span></span>

<span data-ttu-id="69a29-206">Pour afficher toutes les règles de détection personnalisées existantes, **accédez à recherche**  >  **personnalisée**pour la recherche.</span><span class="sxs-lookup"><span data-stu-id="69a29-206">To view all existing custom detection rules, navigate to **Hunting** > **Custom detections**.</span></span> <span data-ttu-id="69a29-207">La page répertorie toutes les règles avec les informations d’exécution suivantes :</span><span class="sxs-lookup"><span data-stu-id="69a29-207">The page lists all the rules with the following run information:</span></span>

- <span data-ttu-id="69a29-208">**Dernière exécution**: lors de la dernière exécution d’une règle pour rechercher les correspondances des requêtes et générer des alertes</span><span class="sxs-lookup"><span data-stu-id="69a29-208">**Last run**—when a rule was last run to check for query matches and generate alerts</span></span>
- <span data-ttu-id="69a29-209">**État de la dernière exécution**: indique si une règle a été exécutée avec succès</span><span class="sxs-lookup"><span data-stu-id="69a29-209">**Last run status**—whether a rule ran successfully</span></span>
- <span data-ttu-id="69a29-210">**Exécution suivante**: exécution planifiée suivante</span><span class="sxs-lookup"><span data-stu-id="69a29-210">**Next run**—the next scheduled run</span></span>
- <span data-ttu-id="69a29-211">**État**: indique si une règle a été activée ou désactivée</span><span class="sxs-lookup"><span data-stu-id="69a29-211">**Status**—whether a rule has been turned on or off</span></span>

### <a name="view-rule-details-modify-rule-and-run-rule"></a><span data-ttu-id="69a29-212">Afficher les détails de la règle, modifier la règle et exécuter la règle</span><span class="sxs-lookup"><span data-stu-id="69a29-212">View rule details, modify rule, and run rule</span></span>

<span data-ttu-id="69a29-213">Pour afficher des informations détaillées sur une règle de **détection personnalisée,** consultez la rubrique  >  **détections personnalisées** de la recherche, puis sélectionnez le nom de la règle.</span><span class="sxs-lookup"><span data-stu-id="69a29-213">To view comprehensive information about a custom detection rule, go to **Hunting** > **Custom detections** and then select the name of rule.</span></span> <span data-ttu-id="69a29-214">Vous pouvez ensuite afficher des informations générales sur la règle, notamment les informations relatives à l’État et à l’étendue de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="69a29-214">You can then view general information about the rule, including information its run status and scope.</span></span> <span data-ttu-id="69a29-215">La page fournit également la liste des alertes et des actions déclenchées.</span><span class="sxs-lookup"><span data-stu-id="69a29-215">The page also provides the list of triggered alerts and actions.</span></span>

<span data-ttu-id="69a29-216">![Page des détails de la règle de détection personnalisée](../../media/custom-detection-details.png)</span><span class="sxs-lookup"><span data-stu-id="69a29-216">![Custom detection rule details page](../../media/custom-detection-details.png)</span></span><br>
<span data-ttu-id="69a29-217">*Détails de la règle de détection personnalisée*</span><span class="sxs-lookup"><span data-stu-id="69a29-217">*Custom detection rule details*</span></span>

<span data-ttu-id="69a29-218">Vous pouvez également effectuer les actions suivantes sur la règle à partir de cette page :</span><span class="sxs-lookup"><span data-stu-id="69a29-218">You can also take the following actions on the rule from this page:</span></span>

- <span data-ttu-id="69a29-219">**Exécuter**: exécuter la règle immédiatement.</span><span class="sxs-lookup"><span data-stu-id="69a29-219">**Run**—run the rule immediately.</span></span> <span data-ttu-id="69a29-220">Cela réinitialise également l’intervalle de la prochaine exécution.</span><span class="sxs-lookup"><span data-stu-id="69a29-220">This also resets the interval for the next run.</span></span>
- <span data-ttu-id="69a29-221">**Modifier**: modifier la règle sans modifier la requête</span><span class="sxs-lookup"><span data-stu-id="69a29-221">**Edit**—modify the rule without changing the query</span></span>
- <span data-ttu-id="69a29-222">**Requête modifier**: modifier la requête dans la recherche avancée</span><span class="sxs-lookup"><span data-stu-id="69a29-222">**Modify query**—edit the query in advanced hunting</span></span>
- <span data-ttu-id="69a29-223">**Activer**  /  **Désactiver**: activer la règle ou l’arrêter de s’exécuter</span><span class="sxs-lookup"><span data-stu-id="69a29-223">**Turn on** / **Turn off**—enable the rule or stop it from running</span></span>
- <span data-ttu-id="69a29-224">**Supprimer**: désactiver la règle et la supprimer</span><span class="sxs-lookup"><span data-stu-id="69a29-224">**Delete**—turn off the rule and remove it</span></span>

### <a name="view-and-manage-triggered-alerts"></a><span data-ttu-id="69a29-225">Afficher et gérer les alertes déclenchées</span><span class="sxs-lookup"><span data-stu-id="69a29-225">View and manage triggered alerts</span></span>

<span data-ttu-id="69a29-226">Dans l’écran détails de la**règle (recherche**  >  **personnalisée**de  >  recherche **[nom de la règle]**), accédez à **déclenched Alerts**, qui répertorie les alertes générées par la correspondance avec la règle.</span><span class="sxs-lookup"><span data-stu-id="69a29-226">In the rule details screen (**Hunting** > **Custom detections** > **[Rule name]**), go to  **Triggered alerts**, which lists the alerts generated by matches to the rule.</span></span> <span data-ttu-id="69a29-227">Sélectionnez une alerte pour afficher des informations détaillées le concernant et effectuez les actions suivantes :</span><span class="sxs-lookup"><span data-stu-id="69a29-227">Select an alert to view detailed information about it and take the following actions:</span></span>

- <span data-ttu-id="69a29-228">Gérer l’alerte en définissant son état et sa classification (alerte true ou false)</span><span class="sxs-lookup"><span data-stu-id="69a29-228">Manage the alert by setting its status and classification (true or false alert)</span></span>
- <span data-ttu-id="69a29-229">Liaison de l’alerte à un incident</span><span class="sxs-lookup"><span data-stu-id="69a29-229">Link the alert to an incident</span></span>
- <span data-ttu-id="69a29-230">Exécuter la requête qui a déclenché l’alerte sur la chasse avancée</span><span class="sxs-lookup"><span data-stu-id="69a29-230">Run the query that triggered the alert on advanced hunting</span></span>

### <a name="review-actions"></a><span data-ttu-id="69a29-231">Examiner les actions</span><span class="sxs-lookup"><span data-stu-id="69a29-231">Review actions</span></span>
<span data-ttu-id="69a29-232">Dans l’écran détails de la**règle (recherche**  >  **personnalisée**de  >  recherche **[nom de la règle]**), accédez à **actions déclenchées**, qui répertorie les actions effectuées en fonction des correspondances avec la règle.</span><span class="sxs-lookup"><span data-stu-id="69a29-232">In the rule details screen (**Hunting** > **Custom detections** > **[Rule name]**), go to **Triggered actions**, which lists the actions taken based on matches to the rule.</span></span>

>[!TIP]
><span data-ttu-id="69a29-233">Pour afficher rapidement des informations et agir sur un élément d’un tableau, utilisez la colonne de sélection [&#10003;] à gauche du tableau.</span><span class="sxs-lookup"><span data-stu-id="69a29-233">To quickly view information and take action on an item in a table, use the selection column [&#10003;] at the left of the table.</span></span>

## <a name="related-topic"></a><span data-ttu-id="69a29-234">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="69a29-234">Related topic</span></span>
- [<span data-ttu-id="69a29-235">Vue d’ensemble des détections personnalisées</span><span class="sxs-lookup"><span data-stu-id="69a29-235">Custom detections overview</span></span>](custom-detections-overview.md)
- [<span data-ttu-id="69a29-236">Vue d’ensemble du repérage avancé</span><span class="sxs-lookup"><span data-stu-id="69a29-236">Advanced hunting overview</span></span>](advanced-hunting-overview.md)
- [<span data-ttu-id="69a29-237">Découvrir le langage de requête de repérage avancé</span><span class="sxs-lookup"><span data-stu-id="69a29-237">Learn the advanced hunting query language</span></span>](advanced-hunting-query-language.md)