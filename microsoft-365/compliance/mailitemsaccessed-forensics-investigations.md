---
title: Utiliser l’audit avancé pour analyser des comptes compromis
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
audience: Admin
ms.topic: article
ms.service: O365-seccomp
localization_priority: Priority
ms.collection:
- M365-security-compliance
search.appverid:
- MOE150
- MET150
ms.assetid: ''
description: Utilisez l’action d’audit de boîte aux lettres MailItemsAccessed pour effectuer des enquêtes légales sur des comptes d'utilisateur compromis.
ms.openlocfilehash: 64f3e5f3423f5182277fe7640199a39dc11068f2
ms.sourcegitcommit: 4886457c0d4248407bddec56425dba50bb60d9c4
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/03/2021
ms.locfileid: "53288778"
---
# <a name="use-advanced-audit-to-investigate-compromised-accounts"></a><span data-ttu-id="607b5-103">Utiliser l’audit avancé pour analyser des comptes compromis</span><span class="sxs-lookup"><span data-stu-id="607b5-103">Use Advanced Audit to investigate compromised accounts</span></span>

<span data-ttu-id="607b5-104">Un compte d’utilisateur compromis (également appelé *prise de contrôle de compte*) est un type d’attaque permettant à une personne malveillante d’accéder à un compte utilisateur et d'agir à sa place.</span><span class="sxs-lookup"><span data-stu-id="607b5-104">A compromised user account (also called an *account takeover*) is a type of attack when an attacker gains access to a user account and operates as the user.</span></span> <span data-ttu-id="607b5-105">Ces types d’attaques peuvent parfois occasionner des dommages plus importants que ceux que la personne malveillante a initialement prévu.</span><span class="sxs-lookup"><span data-stu-id="607b5-105">These types of attacks sometimes cause more damage than the attacker may have intended.</span></span> <span data-ttu-id="607b5-106">Lors de l'analyse de comptes de messagerie compromis, considérez que beaucoup plus de données de courrier sont compromises par rapport à ce qui peut être indiqué en suivant la présence réelle de l’attaquant.</span><span class="sxs-lookup"><span data-stu-id="607b5-106">When investigating compromised email accounts, you have to assume that more mail data was compromised than may be indicated by tracing the attacker's actual presence.</span></span> <span data-ttu-id="607b5-107">Selon le type de données figurant dans les messages électroniques, vous devez supposer que les informations sensibles ont été compromises, ou font face à des sanctions pour infraction à un règlement, sauf si vous pouvez prouver que les informations sensibles n’ont pas été exposées.</span><span class="sxs-lookup"><span data-stu-id="607b5-107">Depending on the type of data in email messages, you have to assume that sensitive information was compromised or face regulatory fines unless you can prove that sensitive information wasn't exposed.</span></span> <span data-ttu-id="607b5-108">Par exemple, les organisations réglementées par le HIPAA sont confrontées à des amendes importantes s’il s'avère que des informations sur la santé des patients ont été exposées.</span><span class="sxs-lookup"><span data-stu-id="607b5-108">For example, HIPAA-regulated organizations face significant fines if there is evidence that patient health information (PHI) was exposed.</span></span> <span data-ttu-id="607b5-109">Dans ces cas, il est peu probable que les personnes malveillantes s'intéressent aux dossiers contenant des renseignements médicaux protégés (PHI), mais les organisations doivent tout de même signaler les violations de données, sauf si elles peuvent prouver le cas contraire.</span><span class="sxs-lookup"><span data-stu-id="607b5-109">In these cases, attackers are unlikely to be interested in PHI, but organizations still must report data breaches unless they can prove otherwise.</span></span>

<span data-ttu-id="607b5-110">Pour faciliter votre enquête sur des comptes de courrier compromis, nous auditons désormais les accès aux données de messages par protocoles de courrier et clients avec l’action d’audit de boîte aux lettres *MailItemsAccessed*.</span><span class="sxs-lookup"><span data-stu-id="607b5-110">To help you with investigating compromise email accounts, we're now auditing accesses of mail data by mail protocols and clients with the *MailItemsAccessed* mailbox auditing action.</span></span> <span data-ttu-id="607b5-111">Cette nouvelle action d’audit aidera les investigateurs à mieux comprendre les violations de données de messagerie et vous permettra d'identifier l’étendue des compromissions de certains éléments de courrier précis susceptibles d’être corrompus.</span><span class="sxs-lookup"><span data-stu-id="607b5-111">This new audited action will help investigators better understand email data breaches and help you identify the scope of compromises to specific mail items that may been compromised.</span></span> <span data-ttu-id="607b5-112">La défendabilité légale est l'objectif de l'emploi de cette nouvelle action d'audit pour affirmer que des données précises d'un e-mail ne sont pas compromise.</span><span class="sxs-lookup"><span data-stu-id="607b5-112">The goal of using this new auditing action is forensics defensibility to help assert that a specific piece of mail data was not compromised.</span></span> <span data-ttu-id="607b5-113">Si une personne malveillante accède à un message spécifique, Exchange Online audite l’événement, même si rien n'indique que le courrier a été véritablement lu.</span><span class="sxs-lookup"><span data-stu-id="607b5-113">If an attacker gained access to a specific piece of mail, Exchange Online audits the event even though there is no indication that the mail item was actually read.</span></span>

## <a name="the-mailitemsaccessed-mailbox-auditing-action"></a><span data-ttu-id="607b5-114">Action d’audit de boîte aux lettres MailItemsAccessed</span><span class="sxs-lookup"><span data-stu-id="607b5-114">The MailItemsAccessed mailbox auditing action</span></span>

<span data-ttu-id="607b5-115">La nouvelle action MailItemsAccessed fait partie de la récente fonctionnalité d’[audit avancé](advanced-audit.md)t.</span><span class="sxs-lookup"><span data-stu-id="607b5-115">The new MailItemsAccessed action is part of the new [Advanced Audit](advanced-audit.md) functionality.</span></span> <span data-ttu-id="607b5-116">Elle fait partie de l'[audit de boîte aux lettres Exchange](/office365/securitycompliance/enable-mailbox-auditing#mailbox-auditing-actions) et est activée par défaut pour les utilisateurs auxquels une licence Office 365 ou Microsoft 365 E5 est attribuée ou pour les organisations disposant d’un abonnement au composant Microsoft 365 E5 Conformité.</span><span class="sxs-lookup"><span data-stu-id="607b5-116">It's part of [Exchange mailbox auditing](/office365/securitycompliance/enable-mailbox-auditing#mailbox-auditing-actions) and is enabled by default for users that are assigned an Office 365 or Microsoft 365 E5 license or for organizations with a Microsoft 365 E5 Compliance add-on subscription.</span></span>

<span data-ttu-id="607b5-117">L’action d’audit de boîte aux lettres MailItemsAccessed englobe tous les protocoles de messagerie : POP, IMAP, MAPI, EWS, Exchange ActiveSync et REST.</span><span class="sxs-lookup"><span data-stu-id="607b5-117">The MailItemsAccessed mailbox auditing action covers all mail protocols: POP, IMAP, MAPI, EWS, Exchange ActiveSync, and REST.</span></span> <span data-ttu-id="607b5-118">Il prend en charge également les deux types d’accès aux courriers : *synchronisation* et *liaison*.</span><span class="sxs-lookup"><span data-stu-id="607b5-118">It also covers both types of accessing mail: *sync* and *bind*.</span></span>

### <a name="auditing-sync-access"></a><span data-ttu-id="607b5-119">Audit de l’accès à la synchronisation</span><span class="sxs-lookup"><span data-stu-id="607b5-119">Auditing sync access</span></span>

<span data-ttu-id="607b5-120">Les opérations de synchronisation sont uniquement enregistrées lorsqu’une boîte aux lettres est consultée par une version de bureau du client Outlook pour Windows ou Mac.</span><span class="sxs-lookup"><span data-stu-id="607b5-120">Sync operations are only recorded when a mailbox is accessed by a desktop version of the Outlook client for Windows or Mac.</span></span> <span data-ttu-id="607b5-121">Pendant l’opération de synchronisation, ces clients téléchargent généralement un grand nombre de courriers du cloud vers un ordinateur local.</span><span class="sxs-lookup"><span data-stu-id="607b5-121">During the sync operation, these clients typically download a large set of mail items from the cloud to a local computer.</span></span> <span data-ttu-id="607b5-122">Le volume d’audit pour les opérations de synchronisation est important.</span><span class="sxs-lookup"><span data-stu-id="607b5-122">The audit volume for sync operations is huge.</span></span> <span data-ttu-id="607b5-123">Par conséquent, au lieu de générer un enregistrement d’audit par courrier synchronisé, un événement d’audit est tout simplement créé pour le dossier de courrier contenant les éléments qui ont été synchronisés.</span><span class="sxs-lookup"><span data-stu-id="607b5-123">So, instead of generating an audit record for each mail item that's synched, we just generate an audit event for the mail folder containing items that were synched.</span></span> <span data-ttu-id="607b5-124">Ainsi, l’hypothèse est que *tous* les éléments de courrier présents dans le dossier synchronisé sont corrompus.</span><span class="sxs-lookup"><span data-stu-id="607b5-124">This makes the assumption that *all* mail items in the synched folder have been compromised.</span></span> <span data-ttu-id="607b5-125">Le type d’accès est enregistré dans le champ OperationProperties de l’enregistrement d’audit.</span><span class="sxs-lookup"><span data-stu-id="607b5-125">The access type is recorded in the OperationProperties field of the audit record.</span></span>

<span data-ttu-id="607b5-126">Pour consulter un exemple d’affichage du type d’accès à la synchronisation dans un enregistrement d’audit, voir l’étape 2 de la section [Utiliser les enregistrements d’audit MailItemsAccessed pour des investigations criminalistiques](#use-mailitemsaccessed-audit-records-for-forensic-investigations).</span><span class="sxs-lookup"><span data-stu-id="607b5-126">See step 2 in the [Use MailItemsAccessed audit records for forensic investigations](#use-mailitemsaccessed-audit-records-for-forensic-investigations) section for an example of displaying the sync access type in an audit record.</span></span>

### <a name="auditing-bind-access"></a><span data-ttu-id="607b5-127">Audit de l’accès liaison</span><span class="sxs-lookup"><span data-stu-id="607b5-127">Auditing bind access</span></span>

<span data-ttu-id="607b5-128">Une opération de liaison consiste en un accès individuel à un message électronique.</span><span class="sxs-lookup"><span data-stu-id="607b5-128">A bind operation is an individual access to an email message.</span></span> <span data-ttu-id="607b5-129">Pour l’accès liaison, l’InternetMessageId des messages individuels est enregistré dans l’enregistrement d’audit.</span><span class="sxs-lookup"><span data-stu-id="607b5-129">For bind access, the InternetMessageId of individual messages will be recorded in the audit record.</span></span> <span data-ttu-id="607b5-130">L’action d’audit MailItemsAccessed enregistre les opérations de liaison, puis les rassemble dans un seul enregistrement d’audit.</span><span class="sxs-lookup"><span data-stu-id="607b5-130">The MailItemsAccessed audit action records bind operations and then aggregates into a single audit record.</span></span> <span data-ttu-id="607b5-131">Toutes les opérations de liaison effectuées au cours d’un intervalle de deux minutes sont regroupées dans un seul enregistrement d’audit dans le champ Dossiers de la propriété AuditData.</span><span class="sxs-lookup"><span data-stu-id="607b5-131">All bind operations that occur within a 2-minute interval are aggregated in a single audit record in the Folders field within the AuditData property.</span></span> <span data-ttu-id="607b5-132">Les messages consultés sont identifiés par leur InternetMessageId.</span><span class="sxs-lookup"><span data-stu-id="607b5-132">Each message that was accessed is identified by its InternetMessageId.</span></span> <span data-ttu-id="607b5-133">Le nombre d’opérations de liaison regroupées dans l’enregistrement s’affiche dans le champ OperationCount de la propriété AuditData.</span><span class="sxs-lookup"><span data-stu-id="607b5-133">The number of bind operations that were aggregated in the record is displayed in the OperationCount field in the AuditData property.</span></span>

<span data-ttu-id="607b5-134">Pour consulter un exemple d’affichage du type d’accès à la liaison dans un enregistrement d’audit, voir l’étape 4 de la section [Utiliser les enregistrements d’audit MailItemsAccessed pour des investigations criminalistiques](#use-mailitemsaccessed-audit-records-for-forensic-investigations).</span><span class="sxs-lookup"><span data-stu-id="607b5-134">See step 4 in the [Use MailItemsAccessed audit records for forensic investigations](#use-mailitemsaccessed-audit-records-for-forensic-investigations) section for an example of displaying the bind access type in an audit record.</span></span>

### <a name="throttling-of-mailitemsaccessed-audit-records"></a><span data-ttu-id="607b5-135">Limitation des enregistrements d’audit MailItemsAccessed</span><span class="sxs-lookup"><span data-stu-id="607b5-135">Throttling of MailItemsAccessed audit records</span></span>

<span data-ttu-id="607b5-136">Si plus de 1 000 enregistrements d’audit MailItemsAccessed sont générés en moins de 24 heures, Exchange Online stoppe la génération des enregistrements d’audit pour l’activité MailItemsAccessed.</span><span class="sxs-lookup"><span data-stu-id="607b5-136">If more than 1,000 MailItemsAccessed audit records are generated in less than 24 hours, Exchange Online will stop generating auditing records for MailItemsAccessed activity.</span></span> <span data-ttu-id="607b5-137">Lorsqu’une boîte aux lettres est limitée, l’activité MailItemsAccessed n’est pas enregistrée durant les 24 heures suivant la limitation de la boîte aux lettres.</span><span class="sxs-lookup"><span data-stu-id="607b5-137">When a mailbox is throttled, MailItemsAccessed activity will not be logged for 24 hours after the mailbox was throttled.</span></span> <span data-ttu-id="607b5-138">Si cela se produit, il est possible que la boîte aux lettres ait été compromise au cours de cette période.</span><span class="sxs-lookup"><span data-stu-id="607b5-138">If this occurs, there's a potential that mailbox could have been compromised during this period.</span></span> <span data-ttu-id="607b5-139">L’enregistrement de l’activité MailItemsAccessed reprend après un délai de 24 heures.</span><span class="sxs-lookup"><span data-stu-id="607b5-139">The recording of MailItemsAccessed activity will be resumed following a 24-hour period.</span></span>

<span data-ttu-id="607b5-140">Voici quelques éléments à se rappeler sur la limitation :</span><span class="sxs-lookup"><span data-stu-id="607b5-140">Here's a few things to keep in mind about throttling:</span></span>

- <span data-ttu-id="607b5-141">Moins de 1 % des boîtes aux lettres sont limitées dans Exchange Online</span><span class="sxs-lookup"><span data-stu-id="607b5-141">Less than 1% of all mailboxes in Exchange Online are throttled</span></span>
- <span data-ttu-id="607b5-p108">Lorsqu’une boîte aux lettres est limitée, seuls les enregistrements d’audit pour l’activité MailItemsAccessed ne sont pas audités. Les autres actions d’audit de boîte aux lettres ne sont pas affectées.</span><span class="sxs-lookup"><span data-stu-id="607b5-p108">When a mailbox is throttling, only audit records for MailItemsAccessed activity are not audited. Other mailbox auditing actions aren't affected.</span></span>
- <span data-ttu-id="607b5-144">Les boîtes aux lettres sont uniquement limitées pour les opérations de liaison.</span><span class="sxs-lookup"><span data-stu-id="607b5-144">Mailboxes are throttled only for Bind operations.</span></span> <span data-ttu-id="607b5-145">Les enregistrements d’audit pour les opérations de synchronisation ne sont pas limités.</span><span class="sxs-lookup"><span data-stu-id="607b5-145">Audit records for sync operations are not throttled.</span></span>
- <span data-ttu-id="607b5-146">Si une boîte aux lettres est limitée, vous pouvez considérer qu’une activité MailItemsAccessed n’a pas été enregistrée dans les journaux d’audit.</span><span class="sxs-lookup"><span data-stu-id="607b5-146">If a mailbox is throttled, you can probably assume there was MailItemsAccessed activity that wasn't recorded in the audit logs.</span></span>

<span data-ttu-id="607b5-147">Pour consulter un exemple d’affichage de la propriété IsThrottled dans un enregistrement d’audit, voir l’étape 1 de la section [Utiliser les enregistrements d’audit MailItemsAccessed pour des investigations criminalistiques](#use-mailitemsaccessed-audit-records-for-forensic-investigations).</span><span class="sxs-lookup"><span data-stu-id="607b5-147">See step 1 in the [Use MailItemsAccessed audit records for forensic investigations](#use-mailitemsaccessed-audit-records-for-forensic-investigations) section for an example of displaying the IsThrottled property in an audit record.</span></span>

## <a name="use-mailitemsaccessed-audit-records-for-forensic-investigations"></a><span data-ttu-id="607b5-148">Utiliser les enregistrements d’audit MailItemsAccessed pour des enquêtes légales</span><span class="sxs-lookup"><span data-stu-id="607b5-148">Use MailItemsAccessed audit records for forensic investigations</span></span>

<span data-ttu-id="607b5-149">L’audit de boîte aux lettres génère des enregistrements d’audit pour l’accès aux courriers afin d'être certain que les messages n’ont pas été compromis.</span><span class="sxs-lookup"><span data-stu-id="607b5-149">Mailbox auditing generates audit records for access to email messages so that you can be confident that email messages haven't been compromised.</span></span> <span data-ttu-id="607b5-150">En conséquence, si des circonstances ne permettent pas d'affirmer qu'un accès aux données a eu lieu, nous supposons qu'il s'est produit en enregistrant toute l'activité d'accès au courrier.</span><span class="sxs-lookup"><span data-stu-id="607b5-150">For this reason, in circumstances where we're not certain that some data has been accessed, we assume that it has by recording all mail access activity.</span></span>

<span data-ttu-id="607b5-151">L'enregistrement à l'aide d’audit MailItemsAccessed à des fins d’enquête légale est généralement effectué après la résolution d’une violation de données et l'éviction de la personne malveillante.</span><span class="sxs-lookup"><span data-stu-id="607b5-151">Using MailItemsAccessed audit records for forensics purposes is typically performed after a data breach has been resolved and the attacker has been evicted.</span></span> <span data-ttu-id="607b5-152">Pour commencer votre enquête, vous devez identifier les boîtes aux lettres qui ont été compromises et déterminer la période durant laquelle la personne malveillante a eu accès aux boîtes aux lettres de votre organisation.</span><span class="sxs-lookup"><span data-stu-id="607b5-152">To begin your investigation, you should identify the set of mailboxes that they have been compromised and determine the time frame when attacker had access to mailboxes in your organization.</span></span> <span data-ttu-id="607b5-153">Puis vous pouvez utiliser les applets de commande **Search-UnifiedAuditLog** ou **Search-MailboxAuditLog** dans [Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell) pour rechercher les enregistrements d’audit correspondant à la violation de données.</span><span class="sxs-lookup"><span data-stu-id="607b5-153">Then, you can use the **Search-UnifiedAuditLog** or **Search-MailboxAuditLog** cmdlets in [Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell) to search audit records that correspond to the data breach.</span></span>

<span data-ttu-id="607b5-154">Vous pouvez exécuter l’une des commandes suivantes pour rechercher les enregistrements d’audit MailItemsAccessed :</span><span class="sxs-lookup"><span data-stu-id="607b5-154">You can run one of the following commands to search for MailItemsAccessed audit records:</span></span>

<span data-ttu-id="607b5-155">**Journal d'audit unifié** :</span><span class="sxs-lookup"><span data-stu-id="607b5-155">**Unified audit log**:</span></span>

```powershell
Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000
```

<span data-ttu-id="607b5-156">**Journal d'audit de boîte aux lettres** :</span><span class="sxs-lookup"><span data-stu-id="607b5-156">**Mailbox audit log**:</span></span>

```powershell
Search-MailboxAuditLog -Identity <user> -StartDate 01/06/2020 -EndDate 01/20/2020 -Operations MailItemsAccessed -ResultSize 1000 -ShowDetails
```

> [!TIP]
> <span data-ttu-id="607b5-157">La principale différence entre ces deux applets de commande est que vous pouvez utiliser l’applet de commande **Search-UnifiedAuditLog** pour rechercher des enregistrements d’audit pour l’activité effectuée par un ou plusieurs utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="607b5-157">One primary difference between these two cmdlets in that you can use the **Search-UnifiedAuditLog** cmdlet to search for audit records for activity performed by one or more users.</span></span> <span data-ttu-id="607b5-158">La raison est que *UserIds* est un paramètre à valeurs multiples.</span><span class="sxs-lookup"><span data-stu-id="607b5-158">That's because *UserIds* is a multi-value parameter.</span></span> <span data-ttu-id="607b5-159">L’applet de commande **Search-MailboxAuditLog** fait une recherche dans le journal d’audit de boîtes aux lettres d'un utilisateur unique.</span><span class="sxs-lookup"><span data-stu-id="607b5-159">The **Search-MailboxAuditLog** cmdlet searches the mailbox audit log for a single user.</span></span>

<span data-ttu-id="607b5-160">Voici les étapes à suivre pour utiliser les enregistrements d’audit MailItemsAccessed afin d'enquêter sur l'attaque d'un utilisateur compromis.</span><span class="sxs-lookup"><span data-stu-id="607b5-160">Here are the steps for using MailItemsAccessed audit records to investigate a compromised user attack.</span></span> <span data-ttu-id="607b5-161">Chacune de ces étapes présente la syntaxe de commande pour les applets de commande **Search-UnifiedAuditLog** ou **MailboxAuditLog**.</span><span class="sxs-lookup"><span data-stu-id="607b5-161">Each step shows the command syntax for the **Search-UnifiedAuditLog** or **Search-MailboxAuditLog** cmdlets.</span></span>

1. <span data-ttu-id="607b5-162">Vérifiez si la boîte aux lettres a été limitée.</span><span class="sxs-lookup"><span data-stu-id="607b5-162">Check whether the mailbox has been throttled.</span></span> <span data-ttu-id="607b5-163">Dans l'affirmative, cela signifie que certains enregistrements d’audit de boîte aux lettres n’ont pas été enregistrés.</span><span class="sxs-lookup"><span data-stu-id="607b5-163">If so, this would mean that some mailbox auditing records would not have been logged.</span></span> <span data-ttu-id="607b5-164">Dans le cas où les enregistrements d’audit affichent le terme « IsThrottled » sur la valeur « True », vous devez supposer qu’au terme de la période de 24 heures suivant la création de l'enregistrement, l’accès à la boîte aux lettres n’a pas été audité et que toutes les données de courrier ont été compromises.</span><span class="sxs-lookup"><span data-stu-id="607b5-164">In the case that any audit records have the "IsThrottled" is "True," you should assume that for a 24-hour period afterwards that record was generated, that any access to the mailbox was not audited and that all mail data has been compromised.</span></span>

   <span data-ttu-id="607b5-165">Pour effectuer la recherche des enregistrements MailItemsAccessed dans lesquels la boîte aux lettres a été limitée, exécutez la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="607b5-165">To search for MailItemsAccessed records where the mailbox was throttled, run the following command:</span></span>

   <span data-ttu-id="607b5-166">**Journal d'audit unifié** :</span><span class="sxs-lookup"><span data-stu-id="607b5-166">**Unified audit log**:</span></span>

   ```powershell
   Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000 | Where {$_.AuditData -like '*"IsThrottled","Value":"True"*'} | FL
   ```

   <span data-ttu-id="607b5-167">**Journal d'audit de boîte aux lettres** :</span><span class="sxs-lookup"><span data-stu-id="607b5-167">**Mailbox audit log**:</span></span>

   ```powershell
   Search-MailboxAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -Identity <user> -Operations MailItemsAccessed -ResultSize 10000 -ShowDetails | Where {$_.OperationProperties -like "*IsThrottled:True*"} | FL
   ```

2. <span data-ttu-id="607b5-168">Vérifier les activités de synchronisation.</span><span class="sxs-lookup"><span data-stu-id="607b5-168">Check for sync activities.</span></span> <span data-ttu-id="607b5-169">Si une personne malveillante utilise un client de courrier pour télécharger les messages d'une boîte aux lettres, il peut déconnecter l’ordinateur d’internet et accéder aux messages en local sans interagir avec le serveur.</span><span class="sxs-lookup"><span data-stu-id="607b5-169">If an attacker uses an email client to downloaded messages in a mailbox, they can disconnect the computer from the Internet and access the messages locally without interacting with the server.</span></span> <span data-ttu-id="607b5-170">L'audit de boîtes aux lettres ne peut donc pas auditer ces activités.</span><span class="sxs-lookup"><span data-stu-id="607b5-170">This means that mailbox auditing would not be able to audit these activities.</span></span>

   <span data-ttu-id="607b5-171">Pour effectuer la recherche des enregistrements MailItemsAccessed dans lesquels les courriers ont été consultés par une opération de synchronisation, exécutez la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="607b5-171">To search for MailItemsAccessed records where the mail items were accessed by a sync operation, run the following command:</span></span>

   <span data-ttu-id="607b5-172">**Journal d'audit unifié** :</span><span class="sxs-lookup"><span data-stu-id="607b5-172">**Unified audit log**:</span></span>

   ```powershell
   Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 02/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000 | Where {$_.AuditData -like '*"MailAccessType","Value":"Sync"*'} | FL
   ```

   <span data-ttu-id="607b5-173">**Journal d'audit de boîte aux lettres** :</span><span class="sxs-lookup"><span data-stu-id="607b5-173">**Mailbox audit log**:</span></span>

   ```powershell
   Search-MailboxAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -Identity <user> -Operations MailItemsAccessed -ResultSize 10000 -ShowDetails | Where {$_.OperationProperties -like "*MailAccessType:Sync*"} | FL
   ```

3. <span data-ttu-id="607b5-174">Vérifiez les activités de synchronisation pour déterminer si l’une d'entre elles s’est produite dans le même contexte que celle utilisée par l’attaquant qui a accédé à la boîte aux lettres.</span><span class="sxs-lookup"><span data-stu-id="607b5-174">Check sync activities to determine in any of them have occurred in the same context as the one used by the attacker access the mailbox.</span></span> <span data-ttu-id="607b5-175">Le contexte est identifié et peut être distingué par l’adresse IP de l’ordinateur client utilisé pour accéder à la boîte aux lettres et au protocole de courrier.</span><span class="sxs-lookup"><span data-stu-id="607b5-175">Context is identified and differentiated by the IP address of the client computer used to access the mailbox and the mail protocol.</span></span> <span data-ttu-id="607b5-176">Pour plus d’informations, voir la section [Identification des contextes d’accès à d’autres enregistrements d’audit](#identifying-the-access-contexts-of-different-audit-records).</span><span class="sxs-lookup"><span data-stu-id="607b5-176">For more information, see the [Identifying the access contexts of different audit records](#identifying-the-access-contexts-of-different-audit-records) section.</span></span>

   <span data-ttu-id="607b5-177">Utilisez les propriétés répertoriées ci-dessous pour effectuer votre enquête.</span><span class="sxs-lookup"><span data-stu-id="607b5-177">Use the properties listed below to investigate.</span></span> <span data-ttu-id="607b5-178">Ces propriétés sont situées dans la propriété AuditData ou OperationProperties.</span><span class="sxs-lookup"><span data-stu-id="607b5-178">These properties are located in the AuditData or OperationProperties property.</span></span> <span data-ttu-id="607b5-179">Si l’une des synchronisations se produit dans le même contexte que l’activité de la personne malveillante, vous devez supposer que l’attaquant a synchronisé tous les éléments de courrier vers leur client, ce qui signifie que la boîte aux lettres entière a probablement été compromise.</span><span class="sxs-lookup"><span data-stu-id="607b5-179">If any of the syncs occur in the same context as the attacker activity, assume the attacker has synced all mail items to their client, which means the entire mailbox has probably been compromised.</span></span>

   <br>

   ****

   |<span data-ttu-id="607b5-180">Propriété</span><span class="sxs-lookup"><span data-stu-id="607b5-180">Property</span></span>|<span data-ttu-id="607b5-181">Description</span><span class="sxs-lookup"><span data-stu-id="607b5-181">Description</span></span>|
   |---|---|
   |<span data-ttu-id="607b5-182">ClientInfoString</span><span class="sxs-lookup"><span data-stu-id="607b5-182">ClientInfoString</span></span>|<span data-ttu-id="607b5-183">Décrit le protocole, le client (inclut la version).</span><span class="sxs-lookup"><span data-stu-id="607b5-183">Describes protocol, client (includes version)</span></span>|
   |<span data-ttu-id="607b5-184">ClientIPAddress</span><span class="sxs-lookup"><span data-stu-id="607b5-184">ClientIPAddress</span></span>|<span data-ttu-id="607b5-185">Adresse IP de l’ordinateur client.</span><span class="sxs-lookup"><span data-stu-id="607b5-185">IP address of the client machine.</span></span>|
   |<span data-ttu-id="607b5-186">SessionId</span><span class="sxs-lookup"><span data-stu-id="607b5-186">SessionId</span></span>|<span data-ttu-id="607b5-187">ID de session vous permettant de différencier les activités de personnes malveillantes de celles des utilisateur au quotidien sur le même compte (dans le cas d’un compte compromis)</span><span class="sxs-lookup"><span data-stu-id="607b5-187">Session ID helps to differentiate attacker actions vs day-to-day user activities on the same account (in the case of a compromised account)</span></span>|
   |<span data-ttu-id="607b5-188">UserId</span><span class="sxs-lookup"><span data-stu-id="607b5-188">UserId</span></span>|<span data-ttu-id="607b5-189">Nom d’utilisateur principal (UPN) de l’utilisateur lisant le message.</span><span class="sxs-lookup"><span data-stu-id="607b5-189">UPN of the user reading the message.</span></span>|
   |

4. <span data-ttu-id="607b5-p118">Vérifier les activités de liaison. Après avoir suivi les étapes 2 et 3, vous êtes certain que tous les autres accès aux courriers électroniques par l’attaquant sont enregistrés dans les enregistrements d’audit MailItemsAccessed ayant une propriété MailAccessType avec la valeur « Liaison ».</span><span class="sxs-lookup"><span data-stu-id="607b5-p118">Check for bind activities. After performing steps 2 and step 3, you can be confident that all other access to email messages by the attacker will be captured in the MailItemsAccessed audit records that have a MailAccessType property with a value of "Bind".</span></span>

   <span data-ttu-id="607b5-192">Pour effectuer la recherche des enregistrements MailItemsAccessed dans lesquels les courriers ont été consultés par une opération de liaison, exécutez la commande suivante.</span><span class="sxs-lookup"><span data-stu-id="607b5-192">To search for MailItemsAccessed records where the mail items were accessed by a Bind operation, run the following command.</span></span>

   <span data-ttu-id="607b5-193">**Journal d'audit unifié** :</span><span class="sxs-lookup"><span data-stu-id="607b5-193">**Unified audit log**:</span></span>

   ```powershell
   Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000 | Where {$_.AuditData -like '*"MailAccessType","Value":"Bind"*'} | FL
   ```

   <span data-ttu-id="607b5-194">**Journal d'audit de boîte aux lettres** :</span><span class="sxs-lookup"><span data-stu-id="607b5-194">**Mailbox audit log**:</span></span>

   ```powershell
   Search-MailboxAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -Identity <user> -Operations MailItemsAccessed -ResultSize 10000 -ShowDetails | Where {$_.OperationProperties -like "*MailAccessType:Bind*"} | FL
   ```

   <span data-ttu-id="607b5-195">Les messages électroniques consultés sont identifiés par leur ID de message Internet. Vous pouvez également vérifier si les enregistrements d’audit ont le même contexte que ceux destinés à d’autres activités de l’attaquant.</span><span class="sxs-lookup"><span data-stu-id="607b5-195">Email messages that were accessed are identified by their internet message Id. You can also check to see if any audit records have the same context as the ones for other attacker activity.</span></span> <span data-ttu-id="607b5-196">Pour plus d’informations, voir la section [Identification des contextes d’accès à d’autres enregistrements d’audit](#identifying-the-access-contexts-of-different-audit-records).</span><span class="sxs-lookup"><span data-stu-id="607b5-196">For more information, see the [Identifying the access contexts of different audit records](#identifying-the-access-contexts-of-different-audit-records) section.</span></span>

   <span data-ttu-id="607b5-197">Vous pouvez utiliser les données d’audit pour les opérations de liaison de deux façon différentes :</span><span class="sxs-lookup"><span data-stu-id="607b5-197">You can use the audit data for bind operations in two different ways:</span></span>

   - <span data-ttu-id="607b5-198">Accéder ou recueillir tous les courriers électroniques auxquels la personne malveillante a eu accès en utilisant l’InternetMessageId pour les retrouver, puis vérifiez si l’un de ces messages contient des informations sensibles.</span><span class="sxs-lookup"><span data-stu-id="607b5-198">Access or collect all email messages the attacker accessed by using the InternetMessageId to find them and then checking to see if any of those messages contains sensitive information.</span></span>
   - <span data-ttu-id="607b5-199">Utilisez l’InternetMessageId pour rechercher des enregistrements d’audit relatifs à un groupe de courriers électroniques potentiellement sensibles.</span><span class="sxs-lookup"><span data-stu-id="607b5-199">Use the InternetMessageId to search audit records related to a set of potentially sensitive email messages.</span></span> <span data-ttu-id="607b5-200">Ceci est utile si un petit nombre de message vous préoccupe.</span><span class="sxs-lookup"><span data-stu-id="607b5-200">This is useful if you're concerned only about a small number of messages.</span></span>

## <a name="filtering-of-duplicate-audit-records"></a><span data-ttu-id="607b5-201">Filtrage des enregistrements d’audit dupliqués</span><span class="sxs-lookup"><span data-stu-id="607b5-201">Filtering of duplicate audit records</span></span>

<span data-ttu-id="607b5-202">Les enregistrements d’audit dupliqués pour les mêmes opérations de liaison qui se produisent au cours de la même heure sont filtrés pour supprimer les bruits d’audit.</span><span class="sxs-lookup"><span data-stu-id="607b5-202">Duplicate audit records for the same bind operations that occur within an hour of each other are filtered out to remove auditing noise.</span></span> <span data-ttu-id="607b5-203">Les opérations de synchronisation sont également filtrées à intervalles d’une heure.</span><span class="sxs-lookup"><span data-stu-id="607b5-203">Sync operations are also filtered out at one-hour intervals.</span></span> <span data-ttu-id="607b5-204">L’exception à ce processus de déduplication se produit si, pour le même InternetMessageId, l'une des propriétés décrites dans le tableau suivant est différente.</span><span class="sxs-lookup"><span data-stu-id="607b5-204">The exception to this de-duplication process occurs if, for the same InternetMessageId, any of the properties described in the following table are different.</span></span> <span data-ttu-id="607b5-205">Si l’une de ces propriétés est différente dans une opération de duplication, un nouvel enregistrement d’audit est généré.</span><span class="sxs-lookup"><span data-stu-id="607b5-205">If one of these properties is different in a duplicate operation, a new audit record is generated.</span></span> <span data-ttu-id="607b5-206">Ce processus est décrit en détail dans la section suivante.</span><span class="sxs-lookup"><span data-stu-id="607b5-206">This process is described in more detail in the next section.</span></span>

<br>

****

|<span data-ttu-id="607b5-207">Propriété</span><span class="sxs-lookup"><span data-stu-id="607b5-207">Property</span></span>|<span data-ttu-id="607b5-208">Description</span><span class="sxs-lookup"><span data-stu-id="607b5-208">Description</span></span>|
|---|---|
|<span data-ttu-id="607b5-209">ClientIPAddress</span><span class="sxs-lookup"><span data-stu-id="607b5-209">ClientIPAddress</span></span>|<span data-ttu-id="607b5-210">Adresse IP de l’ordinateur client.</span><span class="sxs-lookup"><span data-stu-id="607b5-210">IP address of the client computer.</span></span>|
|<span data-ttu-id="607b5-211">ClientInfoString</span><span class="sxs-lookup"><span data-stu-id="607b5-211">ClientInfoString</span></span>|<span data-ttu-id="607b5-212">Protocole client, client utilisé pour accéder à la boîte aux lettres.</span><span class="sxs-lookup"><span data-stu-id="607b5-212">The client protocol, client used to access the mailbox.</span></span>|
|<span data-ttu-id="607b5-213">ParentFolder</span><span class="sxs-lookup"><span data-stu-id="607b5-213">ParentFolder</span></span>|<span data-ttu-id="607b5-214">Le chemin d’accès complet du dossier de l’élément de courrier qui a été consulté.</span><span class="sxs-lookup"><span data-stu-id="607b5-214">The full folder path of the mail item that was accessed.</span></span>|
|<span data-ttu-id="607b5-215">Logon_type</span><span class="sxs-lookup"><span data-stu-id="607b5-215">Logon_type</span></span>|<span data-ttu-id="607b5-216">Type de connexion de l'utilisateur qui a réalisé l'opération.</span><span class="sxs-lookup"><span data-stu-id="607b5-216">The logon type of the user who performed the action.</span></span> <span data-ttu-id="607b5-217">Les types de connexion (et leur valeur enum correspondante) sont propriétaire (0), administrateur (1) ou délégué (2).</span><span class="sxs-lookup"><span data-stu-id="607b5-217">The logon types (and their corresponding Enum value) are Owner (0), Admin (1), or Delegate (2).</span></span>|
|<span data-ttu-id="607b5-218">MailAccessType</span><span class="sxs-lookup"><span data-stu-id="607b5-218">MailAccessType</span></span>|<span data-ttu-id="607b5-219">Si l’accès est une liaison ou une opération de synchronisation.</span><span class="sxs-lookup"><span data-stu-id="607b5-219">Whether the access is a bind or a sync operation.</span></span>|
|<span data-ttu-id="607b5-220">MailboxUPN</span><span class="sxs-lookup"><span data-stu-id="607b5-220">MailboxUPN</span></span>|<span data-ttu-id="607b5-221">Nom d’utilisateur principal (UPN) de la boîte aux lettres dans laquelle se trouve le message lu.</span><span class="sxs-lookup"><span data-stu-id="607b5-221">The UPN of the mailbox where the message being read is located.</span></span>|
|<span data-ttu-id="607b5-222">Utilisateur</span><span class="sxs-lookup"><span data-stu-id="607b5-222">User</span></span>|<span data-ttu-id="607b5-223">Nom d’utilisateur principal (UPN) de l’utilisateur lisant le message.</span><span class="sxs-lookup"><span data-stu-id="607b5-223">The UPN of the user reading the message.</span></span>|
|<span data-ttu-id="607b5-224">SessionId</span><span class="sxs-lookup"><span data-stu-id="607b5-224">SessionId</span></span>|<span data-ttu-id="607b5-225">L’ID de session vous permet de différencier les actions de l’attaquant et les activités quotidiennes des utilisateurs au sein de la même boîte aux lettres (en cas de compromission d’un compte). pour plus d’informations sur les sessions, voir [Contextualiser l’activité des attaquants dans les sessions Exchange Online](https://techcommunity.microsoft.com/t5/exchange-team-blog/contextualizing-attacker-activity-within-sessions-in-exchange/ba-p/608801).</span><span class="sxs-lookup"><span data-stu-id="607b5-225">The Session Id helps to differentiate attacker actions and day-to-day user activities in the same mailbox (in the case of account compromise) For more information about sessions, see [Contextualizing attacker activity within sessions in Exchange Online](https://techcommunity.microsoft.com/t5/exchange-team-blog/contextualizing-attacker-activity-within-sessions-in-exchange/ba-p/608801).</span></span>|
|

## <a name="identifying-the-access-contexts-of-different-audit-records"></a><span data-ttu-id="607b5-226">Identification des contextes d'accès des différents enregistrements d'audit</span><span class="sxs-lookup"><span data-stu-id="607b5-226">Identifying the access contexts of different audit records</span></span>

<span data-ttu-id="607b5-227">Il est fréquent qu’un attaquant puisse accéder à une boîte aux lettres en même temps que le propriétaire de la boîte aux lettres y accède.</span><span class="sxs-lookup"><span data-stu-id="607b5-227">It's common that an attacker may access a mailbox at the same time the mailbox owner is accessing it.</span></span> <span data-ttu-id="607b5-228">Pour différencier l’accès par la personne malveillante et le propriétaire de la boîte aux lettres, il existe des propriétés d’enregistrement d’audit qui définissent le contexte de l’accès.</span><span class="sxs-lookup"><span data-stu-id="607b5-228">To differentiate between access by the attacker and the mailbox owner, there are audit record properties that define the context of the access.</span></span> <span data-ttu-id="607b5-229">Comme expliqué précédemment, lorsque les valeurs de ces propriétés différentes, même lorsque l’activité se produit dans l’intervalle de cumul, des enregistrements d’audit distincts sont générés.</span><span class="sxs-lookup"><span data-stu-id="607b5-229">As previously explained, when the values for these properties are different, even when the activity occurs within the aggregation interval, separate audit records are generated.</span></span> <span data-ttu-id="607b5-230">L’exemple suivant présente trois enregistrements d’audit différents.</span><span class="sxs-lookup"><span data-stu-id="607b5-230">In the following example, there are three different audit records.</span></span> <span data-ttu-id="607b5-231">Chacun d’eux se distingue par l’ID de session et les propriétés ClientIPAddress.</span><span class="sxs-lookup"><span data-stu-id="607b5-231">Each one is differentiated by the Session Id and ClientIPAddress properties.</span></span> <span data-ttu-id="607b5-232">Les messages consultés sont également identifiés.</span><span class="sxs-lookup"><span data-stu-id="607b5-232">The messages that were accessed are also identified.</span></span>

<br>

****

|<span data-ttu-id="607b5-233">Enregistrement d’audit 1</span><span class="sxs-lookup"><span data-stu-id="607b5-233">Audit record 1</span></span>|<span data-ttu-id="607b5-234">Enregistrement d’audit 2</span><span class="sxs-lookup"><span data-stu-id="607b5-234">Audit record 2</span></span>|<span data-ttu-id="607b5-235">Enregistrement d’audit 3</span><span class="sxs-lookup"><span data-stu-id="607b5-235">Audit record 3</span></span>|
|---|---|---|
|<span data-ttu-id="607b5-236">ClientIPAddress **1**</span><span class="sxs-lookup"><span data-stu-id="607b5-236">ClientIPAddress **1**</span></span><br/><span data-ttu-id="607b5-237">SessionId **2**</span><span class="sxs-lookup"><span data-stu-id="607b5-237">SessionId **2**</span></span>|<span data-ttu-id="607b5-238">ClientIPAddress **2**</span><span class="sxs-lookup"><span data-stu-id="607b5-238">ClientIPAddress **2**</span></span><br/><span data-ttu-id="607b5-239">SessionId **2**</span><span class="sxs-lookup"><span data-stu-id="607b5-239">SessionId **2**</span></span>|<span data-ttu-id="607b5-240">ClientIPAddress **1**</span><span class="sxs-lookup"><span data-stu-id="607b5-240">ClientIPAddress **1**</span></span><br/><span data-ttu-id="607b5-241">SessionId **3**</span><span class="sxs-lookup"><span data-stu-id="607b5-241">SessionId **3**</span></span>|
|<span data-ttu-id="607b5-242">InternetMessageId **A**</span><span class="sxs-lookup"><span data-stu-id="607b5-242">InternetMessageId **A**</span></span><br/><span data-ttu-id="607b5-243">InternetMessageId **D**</span><span class="sxs-lookup"><span data-stu-id="607b5-243">InternetMessageId **D**</span></span><br/><span data-ttu-id="607b5-244">InternetMessageId **E**</span><span class="sxs-lookup"><span data-stu-id="607b5-244">InternetMessageId **E**</span></span><br/><span data-ttu-id="607b5-245">InternetMessageId **F**</span><span class="sxs-lookup"><span data-stu-id="607b5-245">InternetMessageId **F**</span></span><br/>|<span data-ttu-id="607b5-246">InternetMessageId **A**</span><span class="sxs-lookup"><span data-stu-id="607b5-246">InternetMessageId **A**</span></span><br/><span data-ttu-id="607b5-247">InternetMessageId **C**</span><span class="sxs-lookup"><span data-stu-id="607b5-247">InternetMessageId **C**</span></span>|<span data-ttu-id="607b5-248">InternetMessageId **B**</span><span class="sxs-lookup"><span data-stu-id="607b5-248">InternetMessageId **B**</span></span>|
|

<span data-ttu-id="607b5-249">Si l’une des propriétés répertoriées dans le tableau de la [section précédente](#filtering-of-duplicate-audit-records) est différente, un enregistrement d’audit séparé est créé pour suivre le nouveau contexte.</span><span class="sxs-lookup"><span data-stu-id="607b5-249">If any of the properties listed in the table in the [previous section](#filtering-of-duplicate-audit-records) are different, a separate audit record is generated to track the new context.</span></span> <span data-ttu-id="607b5-250">Les accès sont triés dans des enregistrements d’audit distincts en fonction du contexte dans lequel l’activité a eu lieu.</span><span class="sxs-lookup"><span data-stu-id="607b5-250">Accesses will be sorted into the separate audit records depending on the context in which the activity took place.</span></span>

<span data-ttu-id="607b5-p125">Par exemple, dans les enregistrements d’audit illustrés dans la capture d’écran suivante, bien que nous accédions simultanément au courrier à partir d’EWSEditor et d’OWA, l’activité d’accès est compilée dans différents enregistrements d’audit en fonction du contexte dans lequel l’accès a eu lieu. Dans ce cas, le contexte est défini par différentes valeurs pour la propriété ClientInfoString.</span><span class="sxs-lookup"><span data-stu-id="607b5-p125">For example, in audit records shown in the following screenshot, though we are accessing mail from EWSEditor and OWA simultaneously, the access activity is collated in different audit records depending on the context in which the access took place. In this case, the context is defined by different values for the ClientInfoString property.</span></span>

![Enregistrements d’audit différents basés sur le contexte](../media/MailItemsAccessed4.png)

<span data-ttu-id="607b5-254">Voici la syntaxe de la commande présentée dans la capture d'écran précédente :</span><span class="sxs-lookup"><span data-stu-id="607b5-254">Here is the syntax for the command shown in the previous screenshot:</span></span>

```powershell
Search-MailboxAuditLog -Identity admin -ShowDetails -Operations MailItemsAccessed -ResultSize 2000 | Select LastAccessed,Operation,AuditOperationsCountInAggregatedRecord,ClientInfoString
```
